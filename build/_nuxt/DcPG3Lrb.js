import{_ as ie}from"./CcOvacmJ.js";import{l as de,y as P,j as F,z as ue,m as W,c as r,a as t,w as o,k as ce,o as n,d as s,t as b,b as C,f as y,e as I,O as me,F as v,r as k,q as _e,s as z,A as R,h as be,_ as pe,g as fe,B as ve,C as xe,D as he}from"./CSfNu48z.js";import{_ as ye}from"./CxZCYzgM.js";import{_ as ge}from"./IBZ4jdTd.js";import{a as ke,_ as Ve}from"./D_zICvME.js";import{_ as we,a as Ce,b as Ue,c as Te,d as Oe}from"./CRm6MFzp.js";import{_ as je}from"./D1djGihS.js";import{R as Ne,_ as qe,a as Se}from"./ChB0eqjO.js";import{o as D,p as w,n as K,m as X,b as ze,s as U,c as E,d as j,e as J,f as Re,_ as De}from"./NquN9xHw.js";import{_ as Ae}from"./21eeqBYg.js";import{_ as Be}from"./qicmLMUY.js";import{_ as Me}from"./C1elpSFF.js";import{_ as Fe}from"./H7C3BDuY.js";import Ie from"./BVtzwZpo.js";import"./Bv3t9T-3.js";import"./BSWwi08U.js";import"./Bz7h1LFa.js";import"./B9W2P-Ol.js";const Ee={components:{Codemirror:Ne},setup(u){const a=P([]),x=P({name:null,description:null,interval:1,table:null,distinct:null,is_default:!1,groups:[],basedOn:{name:null,value:null,result:null,groupBy:null,operator:null},tables:[],conditions:[{statements:[{column:"",operator:"=",value:[""]}],joins:[],attached:null}]});return{schema:D({name:w(U("Name is required"),j("Name is required")),description:w(U("Description is required"),j("Description is required")),interval:K("interval is required",[X(1),ze(43200)]),action:U("action is required"),table:w(U("Table is required"),J(c=>a.value.map(h=>h.name).includes(c),"invalid table name")),description:U("Description is required"),distinct:w(J(c=>c&&x.value.table?a.value.filter(h=>h.name==x.value.table)[0].children.map(h=>h.name).includes(c):!0,"invalid column name")),conditions:E(D({statements:E(D({column:w(U("column is required"),j("column is required")),operator:w(U("operator is required"),j("operator is required")),value:E(w(U("value is required"),j("value is required"),Re(1)))}))})),basedOn:D({name:w(U("Name is required"),j("based on is required")),operator:w(U("operator is required"),j("operator is required")),value:w(J(c=>!(x.value.basedOn.name=="sum"&&!c),"field is required")),result:w(K("result should be a number"),j("result is required"),X(1,"should be grater than 0"))})}),Tables:a,rule:x}},data(){return{intervalSelected:"Minuets",isOpen:!1,resultTest:{error:null,query:null,rows:[]},addRule:!1,options:Ie}},methods:{async openSideWithRes(){var u,a,x;this.addRule=!0,await((u=this.$refs.rule_table)==null?void 0:u.response),this.Tables=(x=(a=this.$refs.rule_table)==null?void 0:a.response)==null?void 0:x.tables},searchGroupAsync:async u=>{const{data:a}=await F("/groups",{query:{search:u}});return a.map(x=>({label:x.name,value:x.id}))},test(u,a){u.custom=!0,ue(()=>{this.$refs[`input-${a}`][0].input.select()})},switchToSelect(u){u.custom=!1},setMax(u){if(u=="Days")return 43200;if(u=="Hours")return 1440;if(u=="Minuets")return 60},setStep(u){if(u=="Days")return 1440;if(u=="Hours")return 60;if(u=="Minuets")return 1},testQuery(u){this.$refs.ruleForm.validate().then(a=>{const x=JSON.parse(JSON.stringify(u));F("/test",{method:"POST",body:x}).then(l=>{this.isOpen=!0,this.resultTest={error:l.error,query:l.query,rows:l.rows,time:l.time?l.time:0}})})},createRule(){const u=JSON.parse(JSON.stringify(this.rule));F("/rules",{method:"POST",body:u}).then(a=>{W().add({title:"Created successfully",icon:"i-heroicons-x-mark",color:"green"})}).catch(a=>{W().add({title:a.response._data.message,icon:"i-heroicons-x-mark",color:"red"})})}}},V=u=>(xe("data-v-e42b0c79"),u=u(),he(),u),Je={class:"flex gap-2"},Le=["onClick"],Qe={class:"grid grid-cols-3 overflow-y-auto"},He={class:"flex flex-col px-4 pt-12"},Pe=V(()=>s("label",{class:"text-sm p-1"},"Action",-1)),We={class:"border rounded-lg p-4 mb-5"},Ke={key:0},Xe={key:1},Ye={class:"flex my-4 justify-between"},Ze=V(()=>s("label",{class:"block font-medium text-gray-700 dark:text-gray-200 text-sm"},"Set as default Rule: ",-1)),Ge={class:"flex flex-col gap-2"},$e={class:"text-sm text-gray-700 mt-2"},el={class:"p-4 flex-1 col-span-2 overflow-y-auto"},ll={class:"flex justify-end gap-5"},tl={class:"grid grid-cols-4 items-center"},al={class:""},sl=V(()=>s("div",{class:"px-2 flex flex-col items-center"},[s("span",null,"|"),s("small",null,"Join"),s("span",null,"|")],-1)),nl={class:"flex gap-1 items-center relative"},ol={class:"flex float-right"},rl={class:"grid grid-cols-3 items-center"},il={class:"border p-4"},dl={class:"p-4 flex flex-col gap-5 border border-gray-500 rounded"},ul={class:"relative"},cl={class:"relative"},ml={class:"grid grid-cols-3 gap-3"},_l={class:"relative"},bl=["onUpdate:modelValue"],pl=["value","label"],fl=["value","selected","disabled","textContent"],vl=["value","selected","disabled","textContent"],xl=V(()=>s("span",{class:"h-[34px] absolute inset-y-0 end-0 flex items-center pointer-events-none px-2.5"},[s("span",{class:"i-heroicons-chevron-down-20-solid flex-shrink-0 text-gray-400 dark:text-gray-500 h-5 w-5","aria-hidden":"true"})],-1)),hl={key:0,class:"flex flex-col gap-2"},yl={class:"flex justify-center -mt-2"},gl={key:0,class:"text-red-500 text-xs dark:text-red-400 m-0"},kl=["onClick"],Vl=["disabled"],wl=["onUpdate:modelValue"],Cl=["value","label"],Ul=["value","selected","disabled","textContent"],Tl=["value","selected","disabled","textContent"],Ol={class:"absolute inset-y-0 end-0 flex items-center h-8 px-2.5"},jl={class:"flex justify-center"},Nl={key:0,class:"text-red-500 dark:text-red-400 m-0"},ql={class:"flex justify-end gap-5"},Sl={class:"flex justify-end gap-5"},zl=V(()=>s("h4",{class:"text-sm"},"Determiner",-1)),Rl={class:"flex gap-5"},Dl={class:"flex items-center gap-2"},Al=V(()=>s("label",{for:"based_on"},"Based on",-1)),Bl={class:"flex justify-center"},Ml={key:0,class:"text-red-500 dark:text-red-400 m-0 absolute"},Fl=["disabled"],Il=V(()=>s("option",{value:null,selected:!0,disabled:!0,text:"Field"},null,-1)),El=["value","label"],Jl=["value","selected","disabled","textContent"],Ll=["value","selected","disabled","textContent"],Ql=V(()=>s("span",{class:"h-[34px] absolute inset-y-0 end-0 flex items-center pointer-events-none px-2.5"},[s("span",{class:"i-heroicons-chevron-down-20-solid flex-shrink-0 text-gray-400 dark:text-gray-500 h-5 w-5","aria-hidden":"true"})],-1)),Hl={class:"flex justify-center"},Pl={key:0,class:"text-red-500 dark:text-red-400 m-0 absolute"},Wl={class:"flex justify-center"},Kl={key:0,class:"text-red-500 dark:text-red-400 m-0 absolute"},Xl={class:"flex items-center gap-2"},Yl=V(()=>s("label",{for:"based_on"},"Result: ",-1)),Zl={class:"flex justify-center"},Gl={key:0,class:"text-red-500 dark:text-red-400 absolute"},$l={key:0,class:"flex items-center gap-2 mr-20 mt-5 groupBy"},et=V(()=>s("label",{for:"based_on"},"Group by:",-1)),lt={class:"relative mx-3"},tt=["selected"],at=["value","label"],st=["value","selected","disabled","textContent"],nt=["value","selected","disabled","textContent"],ot=V(()=>s("span",{class:"h-[34px] absolute inset-y-0 end-0 flex items-center pointer-events-none px-2.5"},[s("span",{class:"i-heroicons-chevron-down-20-solid flex-shrink-0 text-gray-400 dark:text-gray-500 h-5 w-5","aria-hidden":"true"})],-1)),rt={class:"flex justify-center"},it={key:0,class:"text-red-500 dark:text-red-400 m-0 absolute"},dt={class:"flex items-center justify-between"},ut=V(()=>s("h3",{class:"text-base font-semibold leading-6 text-gray-900 dark:text-white"}," Test Result ",-1)),ct={class:"text-sm m-0 mb-2"},mt={key:0},_t={key:1},bt=V(()=>s("p",{class:"text-sm m-0 mb-2"},"Rows:",-1)),pt={class:"p-3 rounded border-gray-100 border"};function ft(u,a,x,l,c,h){const S=ie,T=be,A=pe,q=fe,B=ye,Y=ge,M=ke,p=Ve,Z=we,O=je,L=Ce,G=qe,$=Se,N=ve,Q=Ue,H=Te,ee=De,le=ce("codemirror"),te=Oe,ae=Ae,se=Be,ne=Me,oe=Fe;return n(),r("div",null,[t(Y,{ref:"rule_table",columns:c.options.columns,filters:c.options.filters,url:"/rules",ui:{th:{base:"text-left"}}},{"action-data":o(({row:e})=>[t(S,{ui:{rounded:"rounded-full"},class:"mx-1 capitalize w-16 justify-center",label:e.action,color:c.options.resolveColor(e.action)},null,8,["label","color"])]),"is_default-data":o(({row:e})=>[t(S,{ui:{rounded:"rounded-full"},class:"mx-1 capitalize w-16 justify-center",label:e.is_default?"default":"NO",color:e.is_default?"blue":"lime"},null,8,["label","color"])]),"interval-data":o(({row:e})=>[t(S,{ui:{rounded:"rounded-full"},class:"mx-1 capitalize w-16 justify-center inline-block overflow-hidden text-ellipsis whitespace-nowrap",label:`${u.$dayjs.duration(e.interval,"m").humanize()}`,title:`${u.$dayjs.duration(e.interval,"m").humanize()}`,color:"amber"},null,8,["label","title"])]),"basedOn-data":o(({row:e})=>[s("span",null,b(e.basedOn.name)+" "+b(e.basedOn.operator)+" "+b(e.basedOn.result),1)]),"extra-header":o(()=>[u.$can("create rules")?(n(),C(T,{key:0,size:"xs",onClick:h.openSideWithRes,label:"Add Rule"},null,8,["onClick"])):y("",!0)]),"name-data":o(({row:e})=>[t(A,{class:"text-primary font-bold underline",to:{name:"rules-id",params:{id:e.id}}},{default:o(()=>[I(b(e.name),1)]),_:2},1032,["to"])]),"actions-data":o(({row:e})=>[s("div",Je,[s("div",{role:"button",onClick:m=>h.testQuery(e)},[t(B,{text:"Test"},{default:o(()=>[t(q,{class:"hover:text-primary mx-1",name:"solar:test-tube-broken"})]),_:1})],8,Le),t(A,{to:`rules/${e.id}`},{default:o(()=>[t(B,{text:"View"},{default:o(()=>[t(q,{class:"hover:text-primary mx-1",name:"carbon:view"})]),_:1})]),_:2},1032,["to"]),t(A,{to:`rules/${e.id}/edit`},{default:o(()=>[t(B,{text:"Edit"},{default:o(()=>[t(q,{class:"hover:text-primary mx-1",name:"carbon:edit"})]),_:1})]),_:2},1032,["to"]),me(u.$slots,"extra-actions",{},void 0,!0)])]),_:3},8,["columns","filters"]),t(oe,{id:"addRule",ui:{width:"w-screen max-w-6xl overflow-y-auto pb-52 "},modelValue:c.addRule,"onUpdate:modelValue":a[23]||(a[23]=e=>c.addRule=e)},{default:o(()=>[t(ee,{ref:"ruleForm",schema:l.schema,state:l.rule,onSubmit:h.createRule},{default:o(()=>[s("div",Qe,[s("div",He,[t(p,{class:"my-2 capitalize",label:"Name",name:"name"},{default:o(()=>[t(M,{icon:"i-line-md-list-3-filled",modelValue:l.rule.name,"onUpdate:modelValue":a[0]||(a[0]=e=>l.rule.name=e),variant:"outline"},null,8,["modelValue"])]),_:1}),t(p,{class:"my-7 capitalize",label:"Description",name:"description"},{default:o(()=>[t(Z,{rows:9,icon:"i-heroicons-rule-circle",size:"md",modelValue:l.rule.description,"onUpdate:modelValue":a[1]||(a[1]=e=>l.rule.description=e),variant:"outline"},null,8,["modelValue"])]),_:1}),Pe,s("div",We,[t(p,{name:"action",class:"my-5 capitalize",ui:{label:{wrapper:"flex gap-5 justify-start"}},label:""},{default:o(()=>[t(O,{modelValue:l.rule.action,"onUpdate:modelValue":a[2]||(a[2]=e=>l.rule.action=e),"value-attribute":"value","option-attribute":"name",options:[{name:"Send email",value:"Email"},{name:"Phone Call",value:"Call"}],placeholder:"Select Action"},null,8,["modelValue"])]),_:1}),t(p,{class:"mb-2 capitalize relative",label:"",name:"groups"},{default:o(()=>[t(O,{modelValue:l.rule.groups,"onUpdate:modelValue":a[3]||(a[3]=e=>l.rule.groups=e),multiple:"",placeholder:"select the groups ....",by:"value","option-attribute":"label",searchable:h.searchGroupAsync,"searchable-placeholder":"Search...",class:"w-full py-2"},{label:o(()=>{var e,m;return[(m=(e=l.rule)==null?void 0:e.groups)!=null&&m.length?(n(),r("span",Ke,[(n(!0),r(v,null,k(l.rule.groups,(d,f)=>(n(),C(S,{class:"mr-2 capitalize justify-center",size:"xs",label:d.label||"N/A",color:"primary",key:f},null,8,["label"]))),128))])):(n(),r("span",Xe,"No groups attached"))]}),_:1},8,["modelValue","searchable"])]),_:1})]),s("div",Ye,[Ze,t(L,{icon:"i-heroicons-rule-circle",size:"md",modelValue:l.rule.is_default,"onUpdate:modelValue":a[4]||(a[4]=e=>l.rule.is_default=e),variant:"outline"},null,8,["modelValue"])]),t(p,{class:"my-2 capitalize",name:"interval"},{default:o(()=>[s("div",Ge,[t(G,{legend:"",ui:{fieldset:"flex gap-3"},onChange:a[5]||(a[5]=e=>l.rule.interval=1),modelValue:c.intervalSelected,"onUpdate:modelValue":a[6]||(a[6]=e=>c.intervalSelected=e),options:["Days","Hours","Minuets"]},null,8,["modelValue"]),s("label",$e,b(`interval ${u.$dayjs.duration(l.rule.interval,"m").humanize()}`),1),t($,{class:"my-2",size:"md",step:h.setStep(c.intervalSelected),max:h.setMax(c.intervalSelected),min:1,modelValue:l.rule.interval,"onUpdate:modelValue":a[7]||(a[7]=e=>l.rule.interval=e),variant:"outline"},null,8,["step","max","modelValue"])])]),_:1})]),s("div",el,[s("div",ll,[t(T,{type:"submit",onClick:a[8]||(a[8]=_e(e=>h.testQuery(l.rule),["prevent"])),color:"orange",variant:"outline"},{default:o(()=>[t(q,{name:"heroicons:play-circle"}),I(" Test Rule ")]),_:1}),t(T,{type:"submit",color:"primary",variant:"outline"},{default:o(()=>[t(q,{name:"line-md:plus"}),I(" Create Rule ")]),_:1})]),t(p,{class:"my-2 capitalize",label:"Tables",name:"table"},{default:o(()=>[s("div",tl,[s("div",al,[t(O,{modelValue:l.rule.table,"onUpdate:modelValue":a[9]||(a[9]=e=>l.rule.table=e),options:l.Tables.map(e=>e.name),placeholder:"Table"},null,8,["modelValue","options"])]),(n(!0),r(v,null,k(l.rule.tables,(e,m)=>(n(),r("div",{key:m,class:"grid items-center",style:{"grid-template-columns":"45px auto"}},[sl,s("div",nl,[t(O,{modelValue:l.rule.tables[m],"onUpdate:modelValue":d=>l.rule.tables[m]=d,class:"flex-auto",options:l.Tables.map(d=>d.name).filter(d=>!l.rule.tables.includes(d)),placeholder:"Table"},null,8,["modelValue","onUpdate:modelValue","options"]),t(N,{role:"button",onClick:d=>l.rule.tables.splice(m,1),class:"text-red-600",name:"i-heroicons-x-circle-16-solid"},null,8,["onClick"])])]))),128))]),s("div",ol,[t(T,{disabled:l.Tables.length<=l.rule.tables.length,class:"ms-auto",onClick:a[10]||(a[10]=e=>l.rule.tables.push({name:null})),color:"primary",variant:"solid",label:"add table"},null,8,["disabled"])])]),_:1}),t(p,{class:"my-5 capitalize",name:"distinct",ui:{label:{wrapper:"flex gap-5 justify-start"}},label:"Distinct"},{hint:o(()=>[t(L,{icon:"i-heroicons-rule-circle",size:"md",disabled:!l.rule.table,modelValue:l.rule.distinct,"onUpdate:modelValue":a[11]||(a[11]=e=>l.rule.distinct=e),variant:"outline"},null,8,["disabled","modelValue"])]),default:o(()=>[s("div",rl,[l.rule.distinct?(n(),C(O,{key:0,modelValue:l.rule.distinct,"onUpdate:modelValue":a[12]||(a[12]=e=>l.rule.distinct=e),options:l.Tables.filter(e=>e.name==l.rule.table)[0].children.map(e=>e.name),placeholder:"Column"},null,8,["modelValue","options"])):y("",!0)])]),_:1}),t(p,{class:"my-2 capitalize",label:"Conditions"},{default:o(()=>[s("div",il,[(n(!0),r(v,null,k(l.rule.conditions,(e,m)=>(n(),r("div",{key:m,class:"my-2 capitalize flex flex-col gap-5"},[e.attached?(n(),C(H,{key:0,ui:{base:"-mx-2 rounded-full  absolute top-1/2 me-2 bg-transparent dark:bg-transparent w-14 h-[30px]"}},{content:o(()=>[t(N,{onClick:d=>l.rule.conditions=l.rule.conditions.filter((f,i)=>i!=m),role:"button",name:"i-heroicons-x-circle-16-solid",class:"w-full h-full text-red-500"},null,8,["onClick"])]),default:o(()=>[t(Q,{class:"my-2",label:e.attached},null,8,["label"])]),_:2},1024)):y("",!0),s("div",dl,[(n(!0),r(v,null,k(e.statements,(d,f)=>(n(),r("div",ul,[s("div",cl,[f?(n(),C(Q,{key:0,class:"mb-3",label:e.joins[f-1]},null,8,["label"])):y("",!0),f?(n(),C(H,{key:1,ui:{wrapper:"",base:"-mx-2 rounded-full  absolute right-0 top-1/2  me-2 bg-transparent dark:bg-transparent w-12 h-[25px]"}},{content:o(()=>[t(N,{onClick:i=>{e.statements=e.statements.filter((g,_)=>_!=f),e.joins=e.joins.filter((g,_)=>_!=f-1)},role:"button",name:"i-heroicons-x-circle-16-solid",class:"w-full h-full text-red-500"},null,8,["onClick"])]),_:2},1024)):y("",!0)]),s("div",ml,[t(p,{name:`conditions.${m}.statements.${f}.column`},{default:o(()=>[s("div",_l,[z(s("select",{class:"appearance-none relative w-full disabled:cursor-not-allowed disabled:opacity-75 focus:outline-none border-0 inline-flex items-center text-left cursor-default rounded-md text-sm gap-x-1.5 px-2.5 py-1.5 shadow-sm bg-white dark:bg-gray-900 text-gray-900 dark:text-white ring-1 ring-inset ring-gray-300 dark:ring-gray-700 focus:ring-2 focus:ring-primary-500 dark:focus:ring-primary-400 pe-9","onUpdate:modelValue":i=>d.column=i,name:"",id:""},[(n(!0),r(v,null,k(l.Tables.filter(i=>l.rule.tables.includes(i.name)||i.name==l.rule.table),(i,g)=>(n(),r(v,null,[i.children?(n(),r("optgroup",{key:`${i.name}-optgroup-${g}`,value:i.name,label:i.name},[(n(!0),r(v,null,k(i.children,(_,re)=>(n(),r("option",{key:`${i.name}.${_.name}`,value:`${i.name}.${_.name}`,selected:_.name===d.column,disabled:_.disabled,textContent:b(_.name)},null,8,fl))),128))],8,pl)):(n(),r("option",{key:`${i.name}-${g}`,value:i.name,selected:i.name===d.column,disabled:i.disabled,textContent:b(i.name)},null,8,vl))],64))),256))],8,bl),[[R,d.column]]),xl])]),_:2},1032,["name"]),t(p,{name:`conditions.${m}.statements.${f}.operator`},{default:o(()=>[(n(),C(O,{disabled:!l.rule.table,modelValue:d.operator,"onUpdate:modelValue":i=>d.operator=i,key:f,options:["=","!=",">","<",">=","<=","NOT IN","IN"],placeholder:"Operator"},null,8,["disabled","modelValue","onUpdate:modelValue"]))]),_:2},1032,["name"]),d.custom?(n(),r("div",hl,[(n(!0),r(v,null,k(d.value,(i,g)=>(n(),C(p,{name:`conditions.${m}.statements.${f}.value.${g}`},{error:o(({error:_})=>[s("div",yl,[_?(n(),r("span",gl,b(_),1)):y("",!0)])]),default:o(()=>[t(M,{type:"text",ref_for:!0,ref:`input-${f}`,disabled:!l.rule.table,modelValue:d.value[g],"onUpdate:modelValue":_=>d.value[g]=_,placeholder:`value ${["IN","NOT IN"].includes(d.operator)?g+1:""}`,ui:{icon:{trailing:{pointer:""}}}},{trailing:o(()=>[g?(n(),C(N,{key:1,onClick:_=>d.value.splice(g,1),role:"button",name:"i-heroicons-trash",class:"w-5 h-5 text-red-500"},null,8,["onClick"])):(n(),C(N,{key:0,onClick:_=>h.switchToSelect(d),role:"button",name:"i-heroicons-x-circle-16-solid",class:"w-5 h-5 text-red-500"},null,8,["onClick"]))]),_:2},1032,["disabled","modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["name"]))),256)),["IN","NOT IN"].includes(d.operator)?(n(),r("span",{key:0,role:"button",class:"float-left text-xs text-center mt-0 text-gray-500",onClick:i=>d.value.push("")},"+ option",8,kl)):y("",!0)])):(n(),r("div",{key:1,disabled:!l.rule.table,class:"relative"},[t(p,{name:`conditions.${m}.statements.${f}.value.0`},{error:o(({error:i})=>[s("div",jl,[i?(n(),r("p",Nl,b(i),1)):y("",!0)])]),default:o(()=>[z(s("select",{class:"appearance-none relative w-full disabled:cursor-not-allowed disabled:opacity-75 focus:outline-none border-0 inline-flex items-center text-left cursor-default rounded-md text-sm gap-x-1.5 px-2.5 py-1.5 shadow-sm bg-white dark:bg-gray-900 text-gray-900 dark:text-white ring-1 ring-inset ring-gray-300 dark:ring-gray-700 focus:ring-2 focus:ring-primary-500 dark:focus:ring-primary-400 pe-9","onUpdate:modelValue":i=>d.value[0]=i,name:"",id:""},[(n(!0),r(v,null,k(l.Tables.filter(i=>l.rule.tables.includes(i.name)||i.name==l.rule.table),(i,g)=>(n(),r(v,null,[i.children?(n(),r("optgroup",{key:`${i.name}-optgroup-${g}`,value:i.name,label:i.name},[(n(!0),r(v,null,k(i.children,(_,re)=>(n(),r("option",{key:`${i.name}.${_.name}`,value:"`"+i.name+"`.`"+_.name+"`",selected:_.name===d.value[0],disabled:_.disabled,textContent:b(_.name)},null,8,Ul))),128))],8,Cl)):(n(),r("option",{key:`${i.name}-${g}`,value:i.name,selected:i.name===d.value[0],disabled:i.disabled,textContent:b(i.name)},null,8,Tl))],64))),256))],8,wl),[[R,d.value[0]]]),s("span",Ol,[t(N,{onClick:i=>h.test(d,f),role:"button",name:"i-heroicons-pencil-square-16-solid",class:"w-5 h-5"},null,8,["onClick"])])]),_:2},1032,["name"])],8,Vl))])]))),256)),s("div",ql,[t(T,{onClick:d=>{l.rule.conditions[m].statements.push({column:"",operator:"=",value:[""],custom:!1}),l.rule.conditions[m].joins.push("OR")},color:"orange",variant:"soft",label:"OR"},null,8,["onClick"]),t(T,{onClick:d=>{l.rule.conditions[m].statements.push({column:"",operator:"=",value:[""],custom:!1}),l.rule.conditions[m].joins.push("AND")},color:"green",variant:"soft",label:"AND"},null,8,["onClick"])])])]))),128)),s("div",Sl,[t(T,{onClick:a[13]||(a[13]=e=>l.rule.conditions.push({statements:[{column:"",operator:"=",value:[""]}],joins:[],attached:"OR"})),color:"orange",variant:"soft",label:"OR Group"}),t(T,{onClick:a[14]||(a[14]=e=>l.rule.conditions.push({statements:[{column:"",operator:"=",value:[""]}],joins:[],attached:"AND"})),color:"green",variant:"soft",label:"AND Group"})])])]),_:1}),zl,s("div",Rl,[t(p,{class:"my-2 capitalize",name:"basedOn.name"},{error:o(({error:e})=>[s("div",Bl,[e?(n(),r("p",Ml,b(e),1)):y("",!0)])]),default:o(()=>[s("div",Dl,[Al,t(O,{disabled:!l.rule.table,id:"based_on","value-attribute":"name","option-attribute":"name",modelValue:l.rule.basedOn.name,"onUpdate:modelValue":a[15]||(a[15]=e=>l.rule.basedOn.name=e),options:[{name:"sum"},{name:"count"}],placeholder:"Based on"},null,8,["disabled","modelValue"])])]),_:1}),t(p,{name:"basedOn.value",class:"flex items-center"},{error:o(({error:e})=>[s("div",Hl,[e?(n(),r("p",Pl,b(e),1)):y("",!0)])]),default:o(()=>[l.rule.basedOn.name=="sum"?(n(),r("div",{key:0,disabled:!l.rule.table,class:"relative"},[z(s("select",{placeholder:"field",class:"appearance-none relative w-full disabled:cursor-not-allowed disabled:opacity-75 focus:outline-none border-0 inline-flex items-center text-left cursor-default rounded-md text-sm gap-x-1.5 px-2.5 py-1.5 shadow-sm bg-white dark:bg-gray-900 text-gray-900 dark:text-white ring-1 ring-inset ring-gray-300 dark:ring-gray-700 focus:ring-2 focus:ring-primary-500 dark:focus:ring-primary-400 pe-9","onUpdate:modelValue":a[16]||(a[16]=e=>l.rule.basedOn.value=e)},[Il,(n(!0),r(v,null,k(l.Tables.filter(e=>l.rule.tables.includes(e.name)||e.name==l.rule.table),(e,m)=>(n(),r(v,null,[e.children?(n(),r("optgroup",{key:`${e.name}-optgroup-${m}`,value:e.name,label:e.name},[(n(!0),r(v,null,k(e.children,(d,f)=>(n(),r("option",{key:`${e.name}.${d.name}`,value:"`"+e.name+"`.`"+d.name+"`",selected:d.name===l.rule.basedOn.value,disabled:d.disabled,textContent:b(d.name)},null,8,Jl))),128))],8,El)):(n(),r("option",{key:`${e.name}-${m}`,value:e.name,selected:e.name===l.rule.basedOn.value,disabled:e.disabled,textContent:b(e.name)},null,8,Ll))],64))),256))],512),[[R,l.rule.basedOn.value]]),Ql],8,Fl)):y("",!0)]),_:1}),t(p,{name:"basedOn.operator",class:"flex items-center"},{error:o(({error:e})=>[s("div",Wl,[e?(n(),r("p",Kl,b(e),1)):y("",!0)])]),default:o(()=>[t(O,{disabled:!l.rule.table,modelValue:l.rule.basedOn.operator,"onUpdate:modelValue":a[17]||(a[17]=e=>l.rule.basedOn.operator=e),options:[">","<",">=","<="],placeholder:"Operator"},null,8,["disabled","modelValue"])]),_:1}),t(p,{name:"basedOn.result",class:"flex items-center"},{error:o(({error:e})=>[s("div",Zl,[e?(n(),r("p",Gl,b(e),1)):y("",!0)])]),default:o(()=>[s("div",Xl,[Yl,t(M,{disabled:!l.rule.table,type:"number",min:1,modelValue:l.rule.basedOn.result,"onUpdate:modelValue":a[18]||(a[18]=e=>l.rule.basedOn.result=e)},null,8,["disabled","modelValue"])])]),_:1})]),t(p,{name:"basedOn.groupBy"},{error:o(({error:e})=>[s("div",rt,[e?(n(),r("p",it,b(e),1)):y("",!0)])]),default:o(()=>[l.rule.basedOn.name=="sum"?(n(),r("div",$l,[et,s("div",lt,[z(s("select",{class:"appearance-none relative disabled:cursor-not-allowed disabled:opacity-75 focus:outline-none border-0 inline-flex items-center text-left cursor-default rounded-md text-sm gap-x-1.5 px-2.5 py-1.5 shadow-sm bg-white dark:bg-gray-900 text-gray-900 dark:text-white ring-1 ring-inset ring-gray-300 dark:ring-gray-700 focus:ring-2 focus:ring-primary-500 dark:focus:ring-primary-400 pe-9","onUpdate:modelValue":a[19]||(a[19]=e=>l.rule.basedOn.groupBy=e),name:"",id:""},[s("option",{value:null,selected:!l.rule.basedOn.value,text:"None"},null,8,tt),(n(!0),r(v,null,k(l.Tables.filter(e=>l.rule.tables.includes(e.name)||e.name==l.rule.table),(e,m)=>(n(),r(v,null,[e.children?(n(),r("optgroup",{key:`${e.name}-optgroup-${m}`,value:e.name,label:e.name},[(n(!0),r(v,null,k(e.children,(d,f)=>(n(),r("option",{key:`${e.name}.${d.name}`,value:"`"+e.name+"`.`"+d.name+"`",selected:d.name===l.rule.basedOn.value,disabled:d.disabled,textContent:b(d.name)},null,8,st))),128))],8,at)):(n(),r("option",{key:`${e.name}-${m}`,value:e.name,selected:e.name===l.rule.basedOn.value,disabled:e.disabled,textContent:b(e.name)},null,8,nt))],64))),256))],512),[[R,l.rule.basedOn.groupBy]]),ot])])):y("",!0)]),_:1})])])]),_:1},8,["schema","state","onSubmit"]),t(ne,{id:"TestResult",ui:{width:"w-full sm:max-w-3xl"},modelValue:c.isOpen,"onUpdate:modelValue":a[22]||(a[22]=e=>c.isOpen=e)},{default:o(()=>[t(se,{ui:{ring:"",divide:"divide-y divide-gray-100 dark:divide-gray-800"}},{header:o(()=>[s("div",dt,[ut,t(T,{color:"gray",variant:"ghost",icon:"i-heroicons-x-mark-20-solid",class:"-my-1",onClick:a[20]||(a[20]=e=>c.isOpen=!1)})])]),footer:o(()=>[c.resultTest.error?(n(),r("div",mt,[t(te,{icon:"i-heroicons-command-line",color:"red",variant:"subtle",title:"Error: ",description:c.resultTest.error},null,8,["description"])])):(n(),r("div",_t,[bt,s("div",pt,[t(ae,{rows:c.resultTest.rows},null,8,["rows"])])]))]),default:o(()=>[s("div",null,[s("p",ct,"Query: "+b(c.resultTest.time)+" milliseconds",1),t(le,{value:c.resultTest.query,"onUpdate:value":a[21]||(a[21]=e=>c.resultTest.query=e),tabSize:2,readOnly:!0,options:{mode:"text/x-sql",theme:"dracula",lineWrapping:!0,styleActiveLine:!1}},null,8,["value"])])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])])}const Dt=de(Ee,[["render",ft],["__scopeId","data-v-e42b0c79"]]);export{Dt as default};
