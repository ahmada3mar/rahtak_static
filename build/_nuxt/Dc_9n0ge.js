import{a as P,_ as q}from"./BSWKwCqX.js";import{c,b,w as n,j as f,aN as u,m as V,x as S,o as d,a as t,e as A,d as h,t as $,f as g,u as T,h as j}from"./BaDTJlVb.js";import{o as k,p as N,d as U,s as _,l as E,_ as R}from"./BFarlzf4.js";import{_ as B}from"./oFK375q7.js";import{_ as D}from"./Bm_J15cA.js";import{_ as O}from"./X1pkN10z.js";import"./BfeqGGKE.js";import"./BT86SFtm.js";import"./B8oC8YW5.js";const w={class:"py-5 px-2"},z={key:0},I=h("h4",{class:"my-5"},"معلومات العميل",-1),M={key:0},G={class:"text-green-500 font-bold"},H={class:"flex mt-5 justify-between"},J=h("h4",{class:"my-5"},"معلومات الدفعة",-1),K={key:2},Q={class:"flex mt-5 justify-between"},W={data(){return{totalTrx:0,isLoading:!1,isUserLoading:!1,input:{},cat:[],billingNo:"",catValue:{name:5},response:null,paid:!1,paymentAmount:0,client:null,user:{name:"",mobile:""},payments:{amount:0,fees:0,addtionalAmount:0}}},mounted(){f(`/sadad/get-service-details/${u().params.id}`).then(i=>{var m;this.input=i.input,this.cat=(m=i.cat)==null?void 0:m.filter(r=>r.code)})},methods:{fetchCustomer(i){i.length==10?(this.isUserLoading=!0,f(`/get-customer?search=${i}`).then(m=>{this.user.name=m.name??"",this.totalTrx=m.transactions_count??0,this.isUserLoading=!1})):(this.user.name="",this.totalTrx=0,this.isUserLoading=!1)},saveUser(){this.client={...this.user}},removeUser(){this.client=null},getFees(){return this.payments.amount<=100?.25:(parseInt((this.payments.amount-1)/100)+1)*.5-.25},inq(){var e;this.isLoading=!0;const[i,m]=u().params.service.split("_");let r={paymentType:this.input.paymentType,catValue:this.catValue.nameEn??"",catNo:((e=this.catValue)==null?void 0:e.code)??"",billingNo:this.billingNo,service:i,id:u().params.id,code:m,billingNoRequired:this.input.billingNoRequired,containsPrepaidCats:this.input.containsPrepaidCats,paymentAmount:this.paymentAmount};f("/sadad/inquire",{method:"POST",body:r}).then(a=>{this.response=a,this.payments.addtionalAmount=parseFloat(a.addtionalAmount),this.payments.amount=parseFloat(a.amount),this.payments.fees=parseFloat(a.fees)}).catch(a=>{V().add({title:a.response._data.message,color:"orange"})}).finally(()=>{this.isLoading=!1})},pay(){var e,a,o;this.isLoading=!0;const[i,m]=u().params.service.split("_");let r={paymentType:this.input.paymentType,catValue:this.catValue.nameEn??"",catNo:((e=this.catValue)==null?void 0:e.code)??"",billingNo:this.billingNo,billerName:i,billerCode:m,billerType:u().params.type,totalPayment:this.response.totalPayment,dueAmount:this.response.dueAmount,serviceTypeNo:u().params.id,transType:this.response.transType,amount:this.response.amount,fees:this.response.fees,rahtak_fees:this.getFees(),validationCode:this.response.validationCode,clientName:((a=this.client)==null?void 0:a.name)??"ahmad",clientMobile:((o=this.client)==null?void 0:o.mobile)??"0799991230",billingNoRequired:this.input.billingNoRequired,containsPrepaidCats:this.input.containsPrepaidCats,additionalAmount:this.payments.addtionalAmount??0};f(`/sadad/pay/${u().params.id}`,{method:"POST",body:r}).then(l=>{var p;V().add({title:"تم الدفع بنجاح",color:"green"}),this.paid={transaction:l.bankTrxID,created_at:l.sTMTDate,billerName:i,serviceType:((p=S().list.filter(y=>y.id==u().params.id)[0])==null?void 0:p.serviceNameAr)??u().params.type,invoice:this.billingNo,customerName:l.customerName,amount:this.payments.amount,fees:this.payments.fees,addtionalAmount:this.payments.addtionalAmount,rahtakFees:this.getFees(),total:parseFloat(this.getFees()+Object.values(this.payments).reduce((y,v)=>y+v,0)),branch:"tabrbor"}}).catch(l=>{V().add({title:l.response._data.message,color:"red"})}).finally(()=>{this.isLoading=!1})}}},ne=Object.assign(W,{__name:"index",setup(i){const m=k({name:N(_(),U("اسم العميل مطلوب")),mobile:N(_(),U("رقم العميل مطلوب"),E(10,"رقم العميل يجب ان يكون 10 ارقام"))}),r=k({billingNo:N(_(),U("الحقل مطلوب"))});return(e,a)=>{const o=P,l=q,p=j,y=R,v=B,F=D,C=O;return d(),c("div",w,[e.paid?(d(),b(C,{key:1,details:e.paid},null,8,["details"])):(d(),b(F,{key:0},{default:n(()=>[e.client?(d(),b(y,{key:1,schema:T(r),state:{billingNo:e.billingNo,paymentAmount:e.paymentAmount},onSubmit:a[11]||(a[11]=s=>e.response?e.pay():e.inq())},{default:n(()=>[J,e.cat.length>0?(d(),b(l,{key:0,class:"my-2",label:"الفئة"},{default:n(()=>[t(v,{modelValue:e.catValue,"onUpdate:modelValue":a[3]||(a[3]=s=>e.catValue=s),options:e.cat,"option-attribute":"nameEn"},null,8,["modelValue","options"])]),_:1})):g("",!0),t(l,{class:"my-2",name:"billingNo",label:e.input.arDesc},{default:n(()=>[t(o,{"onUpdate:modelValue":[a[4]||(a[4]=s=>e.response=null),a[5]||(a[5]=s=>e.billingNo=s)],modelValue:e.billingNo,placeholder:e.input.arDesc},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e.input.billingNoRequired&&!e.input.containsPrepaidCats?(d(),b(l,{key:1,name:"paymentAmount",class:"my-2",label:"القيمة"},{default:n(()=>[t(o,{"onUpdate:modelValue":[a[6]||(a[6]=s=>e.response=null),a[7]||(a[7]=s=>e.paymentAmount=s)],modelValue:e.paymentAmount,placeholder:"ادخل القيمة"},null,8,["modelValue"])]),_:1})):g("",!0),e.response?(d(),c("div",K,[t(l,{class:"my-2",label:"اسم العميل"},{default:n(()=>[t(o,{disabled:!0,value:e.response.customerName},null,8,["value"])]),_:1}),t(l,{class:"my-2",label:"ملاحظات"},{default:n(()=>[t(o,{disabled:!0,value:e.response.freeText},null,8,["value"])]),_:1}),t(l,{class:"my-2",label:"الحد الأعلى"},{default:n(()=>[t(o,{disabled:!0,value:e.response.maxPaymentLimit},null,8,["value"])]),_:1}),t(l,{class:"my-2",label:"الحد الأدنى"},{default:n(()=>[t(o,{disabled:!0,value:e.response.minPaymentLimit},null,8,["value"])]),_:1}),t(l,{class:"my-2",label:"القيمة"},{default:n(()=>[t(o,{type:"number",disabled:!e.response.isAmountEnabled,modelValue:e.payments.amount,"onUpdate:modelValue":a[8]||(a[8]=s=>e.payments.amount=s)},null,8,["disabled","modelValue"])]),_:1}),t(l,{class:"my-2",label:"عمولات"},{default:n(()=>[t(o,{disabled:!0,modelValue:e.payments.fees,"onUpdate:modelValue":a[9]||(a[9]=s=>e.payments.fees=s)},null,8,["modelValue"])]),_:1}),t(l,{class:"my-2",label:"القيمة المضافة"},{default:n(()=>[t(o,{disabled:!0,modelValue:e.payments.addtionalAmount,"onUpdate:modelValue":a[10]||(a[10]=s=>e.payments.addtionalAmount=s)},null,8,["modelValue"])]),_:1}),t(l,{class:"my-2",label:"عمولة راحتك"},{default:n(()=>[t(o,{disabled:!0,type:"number",value:e.getFees()},null,8,["value"])]),_:1}),t(l,{class:"my-2",label:"القيمة الكلية"},{default:n(()=>[t(o,{disabled:!0,value:parseFloat(e.getFees()+Object.values(e.payments).reduce((s,L)=>s+L,0)).toFixed(3)},null,8,["value"])]),_:1})])):g("",!0),h("div",Q,[t(p,{onClick:e.removeUser,size:"lg",color:"gray",class:"",label:"رجوع"},null,8,["onClick"]),t(p,{loading:e.isLoading,size:"lg",type:"submit",class:"mr-auto",label:e.response?"دفع":"استعلام"},null,8,["loading","label"])])]),_:1},8,["schema","state"])):(d(),c("div",z,[t(y,{onSubmit:e.saveUser,schema:T(m),state:e.user},{default:n(()=>[I,t(l,{class:"my-2",name:"mobile",label:"رقم هاتف العميل"},{default:n(()=>[t(o,{"onUpdate:modelValue":[e.fetchCustomer,a[0]||(a[0]=s=>e.user.mobile=s)],modelValue:e.user.mobile,placeholder:"رقم الهاتف"},null,8,["onUpdate:modelValue","modelValue"])]),_:1}),t(l,{class:"my-2",name:"name",label:"اسم العميل"},{default:n(()=>[t(o,{loading:e.user.mobile!=""&&e.isUserLoading,disabled:e.user.mobile.length<10,"onUpdate:modelValue":[a[1]||(a[1]=s=>e.client=null),a[2]||(a[2]=s=>e.user.name=s)],modelValue:e.user.name,placeholder:"الأسم"},null,8,["loading","disabled","modelValue"])]),_:1}),e.totalTrx?(d(),c("h3",M,[A(" مجموع حركات العميل "),h("span",G,$(e.totalTrx),1),A(" حركة ")])):g("",!0),h("div",H,[t(p,{size:"lg",type:"submit",class:"mr-auto",label:"التالي"})])]),_:1},8,["onSubmit","schema","state"])]))]),_:1}))])}}});export{ne as default};
