import{u as $}from"./D2hRbPYj.js";import{l as S,H as O,a4 as x,X as j,y as w,a3 as d,o as A,c as J,O as D,q as I,aF as N}from"./C0QMzjgp.js";class g extends Error{constructor(r){super(r),this.message=r,Object.setPrototypeOf(this,g.prototype)}}const P=O({props:{schema:{type:[Object,Function],default:void 0},state:{type:Object,required:!0},validate:{type:Function,default:()=>[]},validateOn:{type:Array,default:()=>["blur","input","change","submit"]}},emits:["submit","error"],setup(e,{expose:r,emit:n}){const s=$("$Z55GngiEgp"),t=N(`form-${s}`);x(()=>{t.on(async i=>{var o;i.type!=="submit"&&((o=e.validateOn)!=null&&o.includes(i.type))&&await a(i.path,{silent:!0})})}),j(()=>{t.reset()});const u=w([]);d("form-errors",u),d("form-events",t);const l=w({});d("form-inputs",l);async function c(){let i=await e.validate(e.state);if(e.schema)if(Y(e.schema))i=i.concat(await B(e.state,e.schema));else if(F(e.schema))i=i.concat(await V(e.state,e.schema));else if(Z(e.schema))i=i.concat(await U(e.state,e.schema));else if(C(e.schema))i=i.concat(await H(e.state,e.schema));else throw new Error("Form validation failed: Unsupported form schema");return i}async function a(i,o={silent:!1}){let p=i;if(i&&!Array.isArray(i)&&(p=[i]),p){const v=u.value.filter(m=>!p.includes(m.path)),b=(await c()).filter(m=>p.includes(m.path));u.value=v.concat(b)}else u.value=await c();if(u.value.length>0){if(o.silent)return!1;throw new g(`Form validation failed: ${JSON.stringify(u.value,null,2)}`)}return e.state}async function f(i){var p;const o=i;try{(p=e.validateOn)!=null&&p.includes("submit")&&await a();const v={...o,data:e.state};n("submit",v)}catch(v){if(!(v instanceof g))throw v;const b={...o,errors:u.value.map(m=>({...m,id:l.value[m.path]}))};n("error",b)}}return r({validate:a,errors:u,setErrors(i,o){o?u.value=u.value.filter(p=>p.path!==o).concat(i):u.value=i},async submit(){await f(new Event("submit"))},getErrors(i){return i?u.value.filter(o=>o.path===i):u.value},clear(i){i?u.value=u.value.filter(o=>o.path!==i):u.value=[]}}),{onSubmit:f}}});function F(e){return e.validate&&e.__isYupSchema__}function M(e){return e.inner!==void 0}async function V(e,r){try{return await r.validate(e,{abortEarly:!1}),[]}catch(n){if(M(n))return n.inner.map(s=>({path:s.path??"",message:s.message}));throw n}}function Y(e){return e.parse!==void 0}async function B(e,r){const n=await r.safeParseAsync(e);return n.success===!1?n.error.issues.map(s=>({path:s.path.join("."),message:s.message})):[]}function Z(e){return e.validateAsync!==void 0&&e.id!==void 0}function G(e){return e.isJoi===!0}async function U(e,r){try{return await r.validateAsync(e,{abortEarly:!1}),[]}catch(n){if(G(n))return n.details.map(s=>({path:s.path.join("."),message:s.message}));throw n}}function C(e){return"_parse"in e||"_run"in e||typeof e=="function"&&"schema"in e}async function H(e,r){var s;return((s=(await("_parse"in r?r._parse(e):"_run"in r?r._run({typed:!1,value:e},{}):r(e))).issues)==null?void 0:s.map(t=>{var u;return{path:((u=t.path)==null?void 0:u.map(l=>l.key).join("."))||"",message:t.message}}))||[]}function L(e,r,n,s,t,u){return A(),J("form",{onSubmit:r[0]||(r[0]=I((...l)=>e.onSubmit&&e.onSubmit(...l),["prevent"]))},[D(e.$slots,"default")],32)}const ce=S(P,[["render",L]]);var _;function R(e){return _==null?void 0:_.get(e)}var E;function X(e){return E==null?void 0:E.get(e)}var k;function q(e,r){var n;return(n=k==null?void 0:k.get(e))==null?void 0:n.get(r)}function h(e){var n,s;const r=typeof e;return r==="string"?`"${e}"`:r==="number"||r==="bigint"||r==="boolean"?`${e}`:r==="object"||r==="function"?(e&&((s=(n=Object.getPrototypeOf(e))==null?void 0:n.constructor)==null?void 0:s.name))??"null":r}function y(e,r,n,s,t){const u=t&&"input"in t?t.input:n.value,l=(t==null?void 0:t.expected)??e.expects??null,c=(t==null?void 0:t.received)??h(u),a={kind:e.kind,type:e.type,input:u,expected:l,received:c,message:`Invalid ${r}: ${l?`Expected ${l} but r`:"R"}eceived ${c}`,requirement:e.requirement,path:t==null?void 0:t.path,issues:t==null?void 0:t.issues,lang:s.lang,abortEarly:s.abortEarly,abortPipeEarly:s.abortPipeEarly},f=e.kind==="schema",i=(t==null?void 0:t.message)??e.message??q(e.reference,a.lang)??(f?X(a.lang):null)??s.message??R(a.lang);i&&(a.message=typeof i=="function"?i(a):i),f&&(n.typed=!1),n.issues?n.issues.push(a):n.issues=[a]}function z(e,r){return{kind:"validation",type:"length",reference:z,async:!1,expects:`${e}`,requirement:e,message:r,_run(n,s){return n.typed&&n.value.length!==this.requirement&&y(this,"length",n,s,{received:`${n.value.length}`}),n}}}function K(e,r){return{kind:"validation",type:"max_value",reference:K,async:!1,expects:`<=${e instanceof Date?e.toJSON():h(e)}`,requirement:e,message:r,_run(n,s){return n.typed&&n.value>this.requirement&&y(this,"value",n,s,{received:n.value instanceof Date?n.value.toJSON():h(n.value)}),n}}}function Q(e,r){return{kind:"validation",type:"min_length",reference:Q,async:!1,expects:`>=${e}`,requirement:e,message:r,_run(n,s){return n.typed&&n.value.length<this.requirement&&y(this,"length",n,s,{received:`${n.value.length}`}),n}}}function T(e,r){return{kind:"validation",type:"min_value",reference:T,async:!1,expects:`>=${e instanceof Date?e.toJSON():h(e)}`,requirement:e,message:r,_run(n,s){return n.typed&&n.value<this.requirement&&y(this,"value",n,s,{received:n.value instanceof Date?n.value.toJSON():h(n.value)}),n}}}function W(e){return{kind:"validation",type:"non_empty",reference:W,async:!1,expects:"!0",message:e,_run(r,n){return r.typed&&r.value.length===0&&y(this,"length",r,n,{received:"0"}),r}}}function ee(){return{kind:"schema",type:"any",reference:ee,expects:"any",async:!1,_run(e){return e.typed=!0,e}}}function ne(e,r){return{kind:"schema",type:"array",reference:ne,expects:"Array",async:!1,item:e,message:r,_run(n,s){var u;const t=n.value;if(Array.isArray(t)){n.typed=!0,n.value=[];for(let l=0;l<t.length;l++){const c=t[l],a=this.item._run({typed:!1,value:c},s);if(a.issues){const f={type:"array",origin:"value",input:t,key:l,value:c};for(const i of a.issues)i.path?i.path.unshift(f):i.path=[f],(u=n.issues)==null||u.push(i);if(n.issues||(n.issues=a.issues),s.abortEarly){n.typed=!1;break}}a.typed||(n.typed=!1),n.value.push(a.value)}}else y(this,"type",n,s);return n}}}function re(e,r){return{kind:"schema",type:"custom",reference:re,expects:"unknown",async:!1,check:e,message:r,_run(n,s){return this.check(n.value)?n.typed=!0:y(this,"type",n,s),n}}}function se(e){return{kind:"schema",type:"number",reference:se,expects:"number",async:!1,message:e,_run(r,n){return typeof r.value=="number"&&!isNaN(r.value)?r.typed=!0:y(this,"type",r,n),r}}}function ie(e,r){return{kind:"schema",type:"object",reference:ie,expects:"Object",async:!1,entries:e,message:r,_run(n,s){var u;const t=n.value;if(t&&typeof t=="object"){n.typed=!0,n.value={};for(const l in this.entries){const c=t[l],a=this.entries[l]._run({typed:!1,value:c},s);if(a.issues){const f={type:"object",origin:"value",input:t,key:l,value:c};for(const i of a.issues)i.path?i.path.unshift(f):i.path=[f],(u=n.issues)==null||u.push(i);if(n.issues||(n.issues=a.issues),s.abortEarly){n.typed=!1;break}}a.typed||(n.typed=!1),(a.value!==void 0||l in t)&&(n.value[l]=a.value)}}else y(this,"type",n,s);return n}}}function te(e){return{kind:"schema",type:"string",reference:te,expects:"string",async:!1,message:e,_run(r,n){return typeof r.value=="string"?r.typed=!0:y(this,"type",r,n),r}}}function ue(e,r){return{kind:"schema",type:"tuple",reference:ue,expects:"Array",async:!1,items:e,message:r,_run(n,s){var u;const t=n.value;if(Array.isArray(t)){n.typed=!0,n.value=[];for(let l=0;l<this.items.length;l++){const c=t[l],a=this.items[l]._run({typed:!1,value:c},s);if(a.issues){const f={type:"array",origin:"value",input:t,key:l,value:c};for(const i of a.issues)i.path?i.path.unshift(f):i.path=[f],(u=n.issues)==null||u.push(i);if(n.issues||(n.issues=a.issues),s.abortEarly){n.typed=!1;break}}a.typed||(n.typed=!1),n.value.push(a.value)}}else y(this,"type",n,s);return n}}}function fe(...e){return{...e[0],pipe:e,_run(r,n){for(const s of e)if(s.kind!=="metadata"){if(r.issues&&(s.kind==="schema"||s.kind==="transformation")){r.typed=!1;break}(!r.issues||!n.abortEarly&&!n.abortPipeEarly)&&(r=s._run(r,n))}return r}}}export{ce as _,ee as a,K as b,ne as c,W as d,re as e,Q as f,z as l,T as m,se as n,ie as o,fe as p,te as s,ue as t};
