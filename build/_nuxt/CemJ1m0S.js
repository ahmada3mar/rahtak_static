import{a as P,_ as q}from"./QFGSFCZw.js";import{c,b,w as o,j as h,aN as m,m as g,s as $,o as u,a,d as f,u as A,f as v,h as j}from"./YQULvX1L.js";import{o as _,p as V,d as N,s as U,l as L,_ as S}from"./-ZZM4apo.js";import{_ as R}from"./Cv4RVFoq.js";import{_ as B}from"./DdGIKTHK.js";import{_ as E}from"./BFvrHYLY.js";const O={class:"py-5 px-2"},w={key:0},D=f("h4",{class:"my-5"},"معلومات العميل",-1),z={class:"flex mt-5 justify-between"},I=f("h4",{class:"my-5"},"معلومات الدفعة",-1),M={key:2},G={class:"flex mt-5 justify-between"},H={data(){return{isUserLoading:!1,input:{},cat:[],billingNo:"",catValue:"",response:null,paid:!1,paymentAmount:0,client:null,user:{name:"",mobile:""},payments:{amount:0,fees:0,addtionalAmount:0}}},mounted(){h(`/sadad/get-service-details/${m().params.id}`).then(i=>{this.input=i.input,this.cat=i.cat})},methods:{fetchCustomer(i){i.length==10?(this.isUserLoading=!0,h(`/get-customer?search=${i}`).then(d=>{this.user.name=d.name??"",this.isUserLoading=!1})):(this.user.name="",this.isUserLoading=!1)},saveUser(){this.client={...this.user}},removeUser(){this.client=null},getFees(){return this.payments.amount<=100?.25:(parseInt((this.payments.amount-1)/100)+1)*.5-.25},inq(){const[i,d]=m().params.service.split("_");let p={paymentType:this.input.paymentType,catValue:this.catValue,billingNo:this.billingNo,service:i,id:m().params.id,code:d,billingNoRequired:this.input.billingNoRequired,containsPrepaidCats:this.input.containsPrepaidCats,paymentAmount:this.paymentAmount};h("/sadad/inquire",{method:"POST",body:p}).then(e=>{this.response=e,this.payments.addtionalAmount=parseFloat(e.addtionalAmount),this.payments.amount=parseFloat(e.amount),this.payments.fees=parseFloat(e.fees)}).catch(e=>{g().add({title:e.response._data.message,color:"orange"})})},pay(){var e,t;const[i,d]=m().params.service.split("_");let p={paymentType:this.input.paymentType,catValue:this.catValue,billingNo:this.billingNo,billerName:i,billerCode:d,billerType:m().params.type,totalPayment:this.response.totalPayment,dueAmount:this.response.dueAmount,serviceTypeNo:m().params.id,transType:this.response.transType,amount:this.response.amount,fees:this.response.fees,rahtak_fees:this.getFees(),validationCode:this.response.validationCode,clientName:((e=this.client)==null?void 0:e.name)??"ahmad",clientMobile:((t=this.client)==null?void 0:t.mobile)??"0799991230",billingNoRequired:this.input.billingNoRequired,containsPrepaidCats:this.input.containsPrepaidCats,additionalAmount:this.payments.addtionalAmount??0};h(`/sadad/pay/${m().params.id}`,{method:"POST",body:p}).then(l=>{var n;g().add({title:"تم الدفع بنجاح",color:"green"}),this.paid={transaction:l.bankTrxID,created_at:l.sTMTDate,billerName:i,serviceType:((n=$().list.filter(r=>r.id==m().params.type)[0])==null?void 0:n.serviceNameAr)??m().params.type,invoice:this.billingNo,customerName:l.customerName,amount:this.payments.amount,fees:this.payments.fees,addtionalAmount:this.payments.addtionalAmount,rahtakFees:this.getFees(),total:parseFloat(this.getFees()+Object.values(this.payments).reduce((r,y)=>r+y,0)),branch:"tabrbor"}}).catch(l=>{g().add({title:l.response._data.message,color:"red"})})}}},Z=Object.assign(H,{__name:"index",setup(i){const d=_({name:V(U(),N("اسم العميل مطلوب")),mobile:V(U(),N("رقم العميل مطلوب"),L(10,"رقم العميل يجب ان يكون 10 ارقام"))}),p=_({billingNo:V(U(),N("الحقل مطلوب"))});return(e,t)=>{const l=P,n=q,r=j,y=S,T=R,k=B,C=E;return u(),c("div",O,[e.paid?(u(),b(C,{key:1,details:e.paid},null,8,["details"])):(u(),b(k,{key:0},{default:o(()=>[e.client?(u(),b(y,{key:1,schema:A(p),state:{billingNo:e.billingNo,paymentAmount:e.paymentAmount},onSubmit:t[11]||(t[11]=s=>e.response?e.pay():e.inq())},{default:o(()=>[I,e.cat.length>1?(u(),b(n,{key:0,class:"my-2",label:"الفئة"},{default:o(()=>[a(T,{modelValue:e.catValue,"onUpdate:modelValue":t[3]||(t[3]=s=>e.catValue=s),options:e.cat,"option-attribute":"nameEn","value-attribute":"nameEn"},null,8,["modelValue","options"])]),_:1})):v("",!0),a(n,{class:"my-2",name:"billingNo",label:e.input.arDesc},{default:o(()=>[a(l,{"onUpdate:modelValue":[t[4]||(t[4]=s=>e.response=null),t[5]||(t[5]=s=>e.billingNo=s)],modelValue:e.billingNo,placeholder:e.input.arDesc},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e.input.billingNoRequired&&!e.input.containsPrepaidCats?(u(),b(n,{key:1,name:"paymentAmount",class:"my-2",label:"القيمة"},{default:o(()=>[a(l,{"onUpdate:modelValue":[t[6]||(t[6]=s=>e.response=null),t[7]||(t[7]=s=>e.paymentAmount=s)],modelValue:e.paymentAmount,placeholder:"ادخل القيمة"},null,8,["modelValue"])]),_:1})):v("",!0),e.response?(u(),c("div",M,[a(n,{class:"my-2",label:"اسم العميل"},{default:o(()=>[a(l,{disabled:!0,value:e.response.customerName},null,8,["value"])]),_:1}),a(n,{class:"my-2",label:"ملاحظات"},{default:o(()=>[a(l,{disabled:!0,value:e.response.freeText},null,8,["value"])]),_:1}),a(n,{class:"my-2",label:"الحد الأعلى"},{default:o(()=>[a(l,{disabled:!0,value:e.response.maxPaymentLimit},null,8,["value"])]),_:1}),a(n,{class:"my-2",label:"الحد الأدنى"},{default:o(()=>[a(l,{disabled:!0,value:e.response.minPaymentLimit},null,8,["value"])]),_:1}),a(n,{class:"my-2",label:"القيمة"},{default:o(()=>[a(l,{type:"number",disabled:!e.response.isAmountEnabled,modelValue:e.payments.amount,"onUpdate:modelValue":t[8]||(t[8]=s=>e.payments.amount=s)},null,8,["disabled","modelValue"])]),_:1}),a(n,{class:"my-2",label:"عمولات"},{default:o(()=>[a(l,{disabled:!0,modelValue:e.payments.fees,"onUpdate:modelValue":t[9]||(t[9]=s=>e.payments.fees=s)},null,8,["modelValue"])]),_:1}),a(n,{class:"my-2",label:"القيمة المضافة"},{default:o(()=>[a(l,{disabled:!0,modelValue:e.payments.addtionalAmount,"onUpdate:modelValue":t[10]||(t[10]=s=>e.payments.addtionalAmount=s)},null,8,["modelValue"])]),_:1}),a(n,{class:"my-2",label:"عمولة راحتك"},{default:o(()=>[a(l,{disabled:!0,type:"number",value:e.getFees()},null,8,["value"])]),_:1}),a(n,{class:"my-2",label:"القيمة الكلية"},{default:o(()=>[a(l,{disabled:!0,value:parseFloat(e.getFees()+Object.values(e.payments).reduce((s,F)=>s+F,0))},null,8,["value"])]),_:1})])):v("",!0),f("div",G,[a(r,{onClick:e.removeUser,size:"lg",color:"gray",class:"",label:"رجوع"},null,8,["onClick"]),a(r,{size:"lg",type:"submit",class:"mr-auto",label:e.response?"دفع":"استعلام"},null,8,["label"])])]),_:1},8,["schema","state"])):(u(),c("div",w,[a(y,{onSubmit:e.saveUser,schema:A(d),state:e.user},{default:o(()=>[D,a(n,{class:"my-2",name:"mobile",label:"رقم هاتف العميل"},{default:o(()=>[a(l,{"onUpdate:modelValue":[e.fetchCustomer,t[0]||(t[0]=s=>e.user.mobile=s)],modelValue:e.user.mobile,placeholder:"رقم الهاتف"},null,8,["onUpdate:modelValue","modelValue"])]),_:1}),a(n,{class:"my-2",name:"name",label:"اسم العميل"},{default:o(()=>[a(l,{loading:e.user.mobile!=""&&e.isUserLoading,disabled:e.user.mobile.length<10,"onUpdate:modelValue":[t[1]||(t[1]=s=>e.client=null),t[2]||(t[2]=s=>e.user.name=s)],modelValue:e.user.name,placeholder:"الأسم"},null,8,["loading","disabled","modelValue"])]),_:1}),f("div",z,[a(r,{size:"lg",type:"submit",class:"mr-auto",label:"التالي"})])]),_:1},8,["onSubmit","schema","state"])]))]),_:1}))])}}});export{Z as default};
