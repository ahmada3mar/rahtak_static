import{l as ae,y as H,j,P as R,m as se,i as ne,z as oe,b as w,w as d,k as re,o as a,c as o,a as n,e as J,f as y,d as s,t as b,F as f,r as g,s as N,A as S,g as ie,h as de,B as ue}from"./C0QMzjgp.js";import{a as ce,_ as me}from"./D2hRbPYj.js";import{_ as _e,a as be,b as pe,c as fe,d as ve}from"./hntELtMf.js";import{_ as ye}from"./CeBeLe1J.js";import{R as he,_ as xe,a as ge}from"./CEVlVBDZ.js";import{o as z,p as k,n as L,m as Q,b as ke,s as V,c as B,d as U,e as A,f as Ve,_ as we}from"./CIG64dBd.js";import{_ as Ce}from"./CQyNw8QI.js";import{_ as Ue}from"./dO6MjP5l.js";import{_ as Te}from"./D-5T6m90.js";import{_ as qe}from"./CQRw3t0R.js";import Oe from"./B_AtC_7c.js";import"./CSR_V0CX.js";import"./ChayOu5x.js";import"./mDn3YsyS.js";import"./DjSKj6tj.js";const je={components:{Codemirror:he},setup(){const u=H([]),t=H({name:null,description:null,interval:1,table:null,distinct:null,is_default:!1,basedOn:{name:null,value:null,result:null,groupBy:null,operator:null},tables:[],conditions:[{statements:[{column:"",operator:"=",value:[""]}],joins:[],attached:null}]}),x=z({name:k(V("Name is required"),U("Name is required")),description:k(V("Description is required"),U("Description is required")),interval:L("interval is required",[Q(1),ke(43200)]),action:V("action is required"),table:k(V("Table is required"),A(l=>u.value.map(_=>_.name).includes(l),"invalid table name")),description:V("Description is required"),distinct:k(A(l=>l&&t.value.table?u.value.filter(_=>_.name==t.value.table)[0].children.map(_=>_.name).includes(l):!0,"invalid column name")),conditions:B(z({statements:B(z({column:k(V("column is required"),U("column is required")),operator:k(V("operator is required"),U("operator is required")),value:B(k(V("value is required"),U("value is required"),Ve(1)))}))})),basedOn:z({name:k(V("Name is required"),U("based on is required")),operator:k(V("operator is required"),U("operator is required")),value:k(A(l=>!(t.value.basedOn.name=="sum"&&!l),"field is required")),result:k(L("result should be a number"),U("result is required"),Q(1,"should be grater than 0"))})});return{rule:t,Tables:u,schema:x}},data(){return{options:Oe,intervalSelected:"Minuets",isOpen:!1,resultTest:{error:null,query:null,rows:[]}}},mounted(){j(`/rules/${(this._.provides[R]||this.$route).params.id}`).then(u=>{var t;this.rule=u,this.Tables=((t=u.availableTables)==null?void 0:t.tables)||[]})},methods:{searchAsync:async u=>{const{data:t}=await j("/roles",{query:{search:u}});return t.map(x=>x.name)},save(){j(`/rules/${(this._.provides[R]||this.$route).params.id}`,{method:"PUT",body:this.rule}).then(()=>{se().add({title:"User updated success",icon:"i-heroicons-check-circle-20-solid"}),ne().replace({name:"rules-id",params:{id:(this._.provides[R]||this.$route).params.id}})})},async openSideWithRes(){var u,t,x;this.addRule=!0,await((u=this.$refs.rule_table)==null?void 0:u.response),this.Tables=(x=(t=this.$refs.rule_table)==null?void 0:t.response)==null?void 0:x.tables},test(u,t){u.custom=!0,oe(()=>{this.$refs[`input-${t}`][0].input.select()})},switchToSelect(u){u.custom=!1},setMax(u){if(u=="Days")return 43200;if(u=="Hours")return 1440;if(u=="Minuets")return 60},setStep(u){if(u=="Days")return 1440;if(u=="Hours")return 60;if(u=="Minuets")return 1},testQuery(u){const t=JSON.parse(JSON.stringify(u));j("/test",{method:"POST",body:t}).then(x=>{this.isOpen=!0,this.resultTest={error:x.error,query:x.query,rows:x.rows,time:x.time?x.time:0}})}}},Ne={key:0,class:"py-8 mb-8 rounded-md"},Se={key:0,class:"flex justify-end gap-5"},ze={class:"grid grid-cols-3 overflow-y-auto"},De={class:"flex flex-col p-4"},Re={class:"flex my-4 justify-between"},Be=s("label",{class:"block font-medium text-gray-700 dark:text-gray-200 text-sm"},"Set as default Rule: ",-1),Ae={class:"flex flex-col gap-2"},Me={class:"text-sm text-gray-700 mt-2"},Fe={class:"p-4 flex-1 col-span-2 overflow-y-auto"},Pe={class:"grid grid-cols-4 items-center"},Ee={class:""},Ie=s("div",{class:"px-2 flex flex-col items-center"},[s("span",null,"|"),s("small",null,"Join"),s("span",null,"|")],-1),He={class:"flex gap-1 items-center relative"},Je={class:"flex float-right"},Le={class:"grid grid-cols-3 items-center"},Qe={class:"border p-4"},We={class:"p-4 flex flex-col gap-5 border border-gray-500 rounded"},Ke={class:"relative"},Xe={class:"relative"},Ye={class:"grid grid-cols-3 gap-3"},Ze={class:"relative"},Ge=["onUpdate:modelValue"],$e=["value","label"],el=["value","selected","disabled","textContent"],ll=["value","selected","disabled","textContent"],tl=s("span",{class:"h-[34px] absolute inset-y-0 end-0 flex items-center pointer-events-none px-2.5"},[s("span",{class:"i-heroicons-chevron-down-20-solid flex-shrink-0 text-gray-400 dark:text-gray-500 h-5 w-5","aria-hidden":"true"})],-1),al={key:0,class:"flex flex-col gap-2"},sl={class:"flex justify-center -mt-2"},nl={key:0,class:"text-red-500 text-xs dark:text-red-400 m-0"},ol=["onClick"],rl=["disabled"],il=["onUpdate:modelValue"],dl=["value","label"],ul=["value","selected","disabled","textContent"],cl=["value","selected","disabled","textContent"],ml={class:"absolute inset-y-0 end-0 flex items-center h-8 px-2.5"},_l={class:"flex justify-center"},bl={key:0,class:"text-red-500 dark:text-red-400 m-0"},pl={class:"flex justify-end gap-5"},fl={class:"flex justify-end gap-5"},vl=s("h4",{class:"text-sm"},"Determiner",-1),yl={class:"flex gap-5"},hl={class:"flex items-center gap-2"},xl=s("label",{for:"based_on"},"Based on",-1),gl={class:"flex justify-center"},kl={key:0,class:"text-red-500 dark:text-red-400 m-0 absolute"},Vl=["disabled"],wl=s("option",{value:null,selected:!0,disabled:!0,text:"Field"},null,-1),Cl=["value","label"],Ul=["value","selected","disabled","textContent"],Tl=["value","selected","disabled","textContent"],ql=s("span",{class:"h-[34px] absolute inset-y-0 end-0 flex items-center pointer-events-none px-2.5"},[s("span",{class:"i-heroicons-chevron-down-20-solid flex-shrink-0 text-gray-400 dark:text-gray-500 h-5 w-5","aria-hidden":"true"})],-1),Ol={class:"flex justify-center"},jl={key:0,class:"text-red-500 dark:text-red-400 m-0 absolute"},Nl={class:"flex justify-center"},Sl={key:0,class:"text-red-500 dark:text-red-400 m-0 absolute"},zl={class:"flex items-center gap-2"},Dl=s("label",{for:"based_on"},"Result: ",-1),Rl={class:"flex justify-center"},Bl={key:0,class:"text-red-500 dark:text-red-400 absolute"},Al={key:0,class:"flex items-center gap-2 mr-20 mt-5 groupBy"},Ml=s("label",{for:"based_on"},"Group by:",-1),Fl={class:"relative mx-3"},Pl=["selected"],El=["value","label"],Il=["value","selected","disabled","textContent"],Hl=["value","selected","disabled","textContent"],Jl=s("span",{class:"h-[34px] absolute inset-y-0 end-0 flex items-center pointer-events-none px-2.5"},[s("span",{class:"i-heroicons-chevron-down-20-solid flex-shrink-0 text-gray-400 dark:text-gray-500 h-5 w-5","aria-hidden":"true"})],-1),Ll={class:"flex justify-center"},Ql={key:0,class:"text-red-500 dark:text-red-400 m-0 absolute"},Wl={key:1,class:"px-5"},Kl={class:"flex items-center justify-between"},Xl=s("h3",{class:"text-base font-semibold leading-6 text-gray-900 dark:text-white"}," Test Result ",-1),Yl={class:"text-sm m-0 mb-2"},Zl={key:0},Gl={key:1},$l=s("p",{class:"text-sm m-0 mb-2"},"Rows:",-1),et={class:"p-3 rounded border-gray-100 border"};function lt(u,t,x,l,_,q){const M=ie,C=de,D=ce,p=me,W=_e,T=ye,F=be,K=xe,X=ge,O=ue,P=pe,E=fe,Y=we,Z=Ce,G=re("codemirror"),$=ve,ee=Ue,I=Te,le=qe;return a(),w(I,{class:"w-full"},{default:d(()=>[l.rule?(a(),o("div",Ne,[n(Y,{schema:l.schema,state:l.rule,onSubmit:q.save},{default:d(()=>[u.$can("update rules")?(a(),o("div",Se,[n(C,{type:"button",onClick:t[0]||(t[0]=e=>q.testQuery(l.rule)),color:"orange",variant:"outline"},{default:d(()=>[n(M,{name:"heroicons:play-circle"}),J(" Test Rule ")]),_:1}),n(C,{type:"submit",color:"primary",variant:"outline"},{default:d(()=>[n(M,{name:"iconoir:save-floppy-disk"}),J(" Save ")]),_:1})])):y("",!0),s("div",ze,[s("div",De,[n(p,{class:"my-2 capitalize",label:"Name",name:"name"},{default:d(()=>[n(D,{icon:"i-line-md-list-3-filled",modelValue:l.rule.name,"onUpdate:modelValue":t[1]||(t[1]=e=>l.rule.name=e),variant:"outline"},null,8,["modelValue"])]),_:1}),n(p,{class:"my-7 capitalize",label:"Description",name:"description"},{default:d(()=>[n(W,{rows:9,icon:"i-heroicons-rule-circle",size:"md",modelValue:l.rule.description,"onUpdate:modelValue":t[2]||(t[2]=e=>l.rule.description=e),variant:"outline"},null,8,["modelValue"])]),_:1}),n(p,{name:"action",class:"my-5 capitalize",ui:{label:{wrapper:"flex gap-5 justify-start"}},label:"Action"},{default:d(()=>[n(T,{modelValue:l.rule.action,"onUpdate:modelValue":t[3]||(t[3]=e=>l.rule.action=e),"value-attribute":"value","option-attribute":"name",options:[{name:"Send email",value:"Email"},{name:"Phone Call",value:"Call"}],placeholder:"Select Action"},null,8,["modelValue"])]),_:1}),s("div",Re,[Be,n(F,{icon:"i-heroicons-rule-circle",size:"md",modelValue:l.rule.is_default,"onUpdate:modelValue":t[4]||(t[4]=e=>l.rule.is_default=e),variant:"outline"},null,8,["modelValue"])]),n(p,{class:"my-2 capitalize",name:"interval"},{default:d(()=>[s("div",Ae,[n(K,{legend:"",ui:{fieldset:"flex gap-3"},onChange:t[5]||(t[5]=e=>l.rule.interval=1),modelValue:_.intervalSelected,"onUpdate:modelValue":t[6]||(t[6]=e=>_.intervalSelected=e),options:["Days","Hours","Minuets"]},null,8,["modelValue"]),s("label",Me,b(`interval ${u.$dayjs.duration(l.rule.interval,"m").humanize()}`),1),n(X,{class:"my-2",size:"md",step:q.setStep(_.intervalSelected),max:q.setMax(_.intervalSelected),min:1,modelValue:l.rule.interval,"onUpdate:modelValue":t[7]||(t[7]=e=>l.rule.interval=e),variant:"outline"},null,8,["step","max","modelValue"])])]),_:1})]),s("div",Fe,[n(p,{class:"my-2 capitalize",label:"Tables",name:"table"},{default:d(()=>[s("div",Pe,[s("div",Ee,[n(T,{modelValue:l.rule.table,"onUpdate:modelValue":t[8]||(t[8]=e=>l.rule.table=e),options:l.Tables.map(e=>e.name),placeholder:"Table"},null,8,["modelValue","options"])]),(a(!0),o(f,null,g(l.rule.tables,(e,m)=>(a(),o("div",{key:m,class:"grid items-center",style:{"grid-template-columns":"45px auto"}},[Ie,s("div",He,[n(T,{modelValue:l.rule.tables[m],"onUpdate:modelValue":i=>l.rule.tables[m]=i,class:"flex-auto",options:l.Tables.map(i=>i.name).filter(i=>!l.rule.tables.includes(i)),placeholder:"Table"},null,8,["modelValue","onUpdate:modelValue","options"]),n(O,{role:"button",onClick:i=>l.rule.tables.splice(m,1),class:"text-red-600",name:"i-heroicons-x-circle-16-solid"},null,8,["onClick"])])]))),128))]),s("div",Je,[n(C,{disabled:l.Tables.length<=l.rule.tables.length,class:"ms-auto",onClick:t[9]||(t[9]=e=>l.rule.tables.push({name:null})),color:"primary",variant:"solid",label:"add table"},null,8,["disabled"])])]),_:1}),n(p,{class:"my-5 capitalize",name:"distinct",ui:{label:{wrapper:"flex gap-5 justify-start"}},label:"Distinct"},{hint:d(()=>[n(F,{icon:"i-heroicons-rule-circle",size:"md",disabled:!l.rule.table,modelValue:l.rule.distinct,"onUpdate:modelValue":t[10]||(t[10]=e=>l.rule.distinct=e),variant:"outline"},null,8,["disabled","modelValue"])]),default:d(()=>[s("div",Le,[l.rule.distinct?(a(),w(T,{key:0,modelValue:l.rule.distinct,"onUpdate:modelValue":t[11]||(t[11]=e=>l.rule.distinct=e),options:l.Tables.filter(e=>e.name==l.rule.table)[0].children.map(e=>e.name),placeholder:"Column"},null,8,["modelValue","options"])):y("",!0)])]),_:1}),n(p,{class:"my-2 capitalize",label:"Conditions"},{default:d(()=>[s("div",Qe,[(a(!0),o(f,null,g(l.rule.conditions,(e,m)=>(a(),o("div",{key:m,class:"my-2 capitalize flex flex-col gap-5"},[e.attached?(a(),w(E,{key:0,ui:{base:"-mx-2 rounded-full  absolute top-1/2 me-2 bg-transparent dark:bg-transparent w-14 h-[30px]"}},{content:d(()=>[n(O,{onClick:i=>l.rule.conditions=l.rule.conditions.filter((v,r)=>r!=m),role:"button",name:"i-heroicons-x-circle-16-solid",class:"w-full h-full text-red-500"},null,8,["onClick"])]),default:d(()=>[n(P,{class:"my-2",label:e.attached},null,8,["label"])]),_:2},1024)):y("",!0),s("div",We,[(a(!0),o(f,null,g(e.statements,(i,v)=>(a(),o("div",Ke,[s("div",Xe,[v?(a(),w(P,{key:0,class:"mb-3",label:e.joins[v-1]},null,8,["label"])):y("",!0),v?(a(),w(E,{key:1,ui:{wrapper:"",base:"-mx-2 rounded-full  absolute right-0 top-1/2  me-2 bg-transparent dark:bg-transparent w-12 h-[25px]"}},{content:d(()=>[n(O,{onClick:r=>{e.statements=e.statements.filter((h,c)=>c!=v),e.joins=e.joins.filter((h,c)=>c!=v-1)},role:"button",name:"i-heroicons-x-circle-16-solid",class:"w-full h-full text-red-500"},null,8,["onClick"])]),_:2},1024)):y("",!0)]),s("div",Ye,[n(p,{name:`conditions.${m}.statements.${v}.column`},{default:d(()=>[s("div",Ze,[N(s("select",{class:"appearance-none relative w-full disabled:cursor-not-allowed disabled:opacity-75 focus:outline-none border-0 inline-flex items-center text-left cursor-default rounded-md text-sm gap-x-1.5 px-2.5 py-1.5 shadow-sm bg-white dark:bg-gray-900 text-gray-900 dark:text-white ring-1 ring-inset ring-gray-300 dark:ring-gray-700 focus:ring-2 focus:ring-primary-500 dark:focus:ring-primary-400 pe-9","onUpdate:modelValue":r=>i.column=r,name:"",id:""},[(a(!0),o(f,null,g(l.Tables.filter(r=>l.rule.tables.includes(r.name)||r.name==l.rule.table),(r,h)=>(a(),o(f,null,[r.children?(a(),o("optgroup",{key:`${r.name}-optgroup-${h}`,value:r.name,label:r.name},[(a(!0),o(f,null,g(r.children,(c,te)=>(a(),o("option",{key:`${r.name}.${c.name}`,value:`${r.name}.${c.name}`,selected:c.name===i.column,disabled:c.disabled,textContent:b(c.name)},null,8,el))),128))],8,$e)):(a(),o("option",{key:`${r.name}-${h}`,value:r.name,selected:r.name===i.column,disabled:r.disabled,textContent:b(r.name)},null,8,ll))],64))),256))],8,Ge),[[S,i.column]]),tl])]),_:2},1032,["name"]),n(p,{name:`conditions.${m}.statements.${v}.operator`},{default:d(()=>[(a(),w(T,{disabled:!l.rule.table,modelValue:i.operator,"onUpdate:modelValue":r=>i.operator=r,key:v,options:["=","!=",">","<",">=","<=","NOT IN","IN"],placeholder:"Operator"},null,8,["disabled","modelValue","onUpdate:modelValue"]))]),_:2},1032,["name"]),i.custom?(a(),o("div",al,[(a(!0),o(f,null,g(i.value,(r,h)=>(a(),w(p,{name:`conditions.${m}.statements.${v}.value.${h}`},{error:d(({error:c})=>[s("div",sl,[c?(a(),o("span",nl,b(c),1)):y("",!0)])]),default:d(()=>[n(D,{type:"text",ref_for:!0,ref:`input-${v}`,disabled:!l.rule.table,modelValue:i.value[h],"onUpdate:modelValue":c=>i.value[h]=c,placeholder:`value ${["IN","NOT IN"].includes(i.operator)?h+1:""}`,ui:{icon:{trailing:{pointer:""}}}},{trailing:d(()=>[h?(a(),w(O,{key:1,onClick:c=>i.value.splice(h,1),role:"button",name:"i-heroicons-trash",class:"w-5 h-5 text-red-500"},null,8,["onClick"])):(a(),w(O,{key:0,onClick:c=>q.switchToSelect(i),role:"button",name:"i-heroicons-x-circle-16-solid",class:"w-5 h-5 text-red-500"},null,8,["onClick"]))]),_:2},1032,["disabled","modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["name"]))),256)),["IN","NOT IN"].includes(i.operator)?(a(),o("span",{key:0,role:"button",class:"float-left text-xs text-center mt-0 text-gray-500",onClick:r=>i.value.push("")},"+ option",8,ol)):y("",!0)])):(a(),o("div",{key:1,disabled:!l.rule.table,class:"relative"},[n(p,{name:`conditions.${m}.statements.${v}.value.0`},{error:d(({error:r})=>[s("div",_l,[r?(a(),o("p",bl,b(r),1)):y("",!0)])]),default:d(()=>[N(s("select",{class:"appearance-none relative w-full disabled:cursor-not-allowed disabled:opacity-75 focus:outline-none border-0 inline-flex items-center text-left cursor-default rounded-md text-sm gap-x-1.5 px-2.5 py-1.5 shadow-sm bg-white dark:bg-gray-900 text-gray-900 dark:text-white ring-1 ring-inset ring-gray-300 dark:ring-gray-700 focus:ring-2 focus:ring-primary-500 dark:focus:ring-primary-400 pe-9","onUpdate:modelValue":r=>i.value[0]=r,name:"",id:""},[(a(!0),o(f,null,g(l.Tables.filter(r=>l.rule.tables.includes(r.name)||r.name==l.rule.table),(r,h)=>(a(),o(f,null,[r.children?(a(),o("optgroup",{key:`${r.name}-optgroup-${h}`,value:r.name,label:r.name},[(a(!0),o(f,null,g(r.children,(c,te)=>(a(),o("option",{key:`${r.name}.${c.name}`,value:"`"+r.name+"`.`"+c.name+"`",selected:c.name===i.value[0],disabled:c.disabled,textContent:b(c.name)},null,8,ul))),128))],8,dl)):(a(),o("option",{key:`${r.name}-${h}`,value:r.name,selected:r.name===i.value[0],disabled:r.disabled,textContent:b(r.name)},null,8,cl))],64))),256))],8,il),[[S,i.value[0]]]),s("span",ml,[n(O,{onClick:r=>q.test(i,v),role:"button",name:"i-heroicons-pencil-square-16-solid",class:"w-5 h-5"},null,8,["onClick"])])]),_:2},1032,["name"])],8,rl))])]))),256)),s("div",pl,[n(C,{onClick:i=>{l.rule.conditions[m].statements.push({column:"",operator:"=",value:[""],custom:!1}),l.rule.conditions[m].joins.push("OR")},color:"orange",variant:"soft",label:"OR"},null,8,["onClick"]),n(C,{onClick:i=>{l.rule.conditions[m].statements.push({column:"",operator:"=",value:[""],custom:!1}),l.rule.conditions[m].joins.push("AND")},color:"green",variant:"soft",label:"AND"},null,8,["onClick"])])])]))),128)),s("div",fl,[n(C,{onClick:t[12]||(t[12]=e=>l.rule.conditions.push({statements:[{column:"",operator:"=",value:[""]}],joins:[],attached:"OR"})),color:"orange",variant:"soft",label:"OR Group"}),n(C,{onClick:t[13]||(t[13]=e=>l.rule.conditions.push({statements:[{column:"",operator:"=",value:[""]}],joins:[],attached:"AND"})),color:"green",variant:"soft",label:"AND Group"})])])]),_:1}),vl,s("div",yl,[n(p,{class:"my-2 capitalize",name:"basedOn.name"},{error:d(({error:e})=>[s("div",gl,[e?(a(),o("p",kl,b(e),1)):y("",!0)])]),default:d(()=>[s("div",hl,[xl,n(T,{disabled:!l.rule.table,id:"based_on","value-attribute":"name","option-attribute":"name",modelValue:l.rule.basedOn.name,"onUpdate:modelValue":t[14]||(t[14]=e=>l.rule.basedOn.name=e),options:[{name:"sum"},{name:"count"}],placeholder:"Based on"},null,8,["disabled","modelValue"])])]),_:1}),n(p,{name:"basedOn.value",class:"flex items-center"},{error:d(({error:e})=>[s("div",Ol,[e?(a(),o("p",jl,b(e),1)):y("",!0)])]),default:d(()=>[l.rule.basedOn.name=="sum"?(a(),o("div",{key:0,disabled:!l.rule.table,class:"relative"},[N(s("select",{placeholder:"field",class:"appearance-none relative w-full disabled:cursor-not-allowed disabled:opacity-75 focus:outline-none border-0 inline-flex items-center text-left cursor-default rounded-md text-sm gap-x-1.5 px-2.5 py-1.5 shadow-sm bg-white dark:bg-gray-900 text-gray-900 dark:text-white ring-1 ring-inset ring-gray-300 dark:ring-gray-700 focus:ring-2 focus:ring-primary-500 dark:focus:ring-primary-400 pe-9","onUpdate:modelValue":t[15]||(t[15]=e=>l.rule.basedOn.value=e)},[wl,(a(!0),o(f,null,g(l.Tables.filter(e=>l.rule.tables.includes(e.name)||e.name==l.rule.table),(e,m)=>(a(),o(f,null,[e.children?(a(),o("optgroup",{key:`${e.name}-optgroup-${m}`,value:e.name,label:e.name},[(a(!0),o(f,null,g(e.children,(i,v)=>(a(),o("option",{key:`${e.name}.${i.name}`,value:"`"+e.name+"`.`"+i.name+"`",selected:i.name===l.rule.basedOn.value,disabled:i.disabled,textContent:b(i.name)},null,8,Ul))),128))],8,Cl)):(a(),o("option",{key:`${e.name}-${m}`,value:e.name,selected:e.name===l.rule.basedOn.value,disabled:e.disabled,textContent:b(e.name)},null,8,Tl))],64))),256))],512),[[S,l.rule.basedOn.value]]),ql],8,Vl)):y("",!0)]),_:1}),n(p,{name:"basedOn.operator",class:"flex items-center"},{error:d(({error:e})=>[s("div",Nl,[e?(a(),o("p",Sl,b(e),1)):y("",!0)])]),default:d(()=>[n(T,{disabled:!l.rule.table,modelValue:l.rule.basedOn.operator,"onUpdate:modelValue":t[16]||(t[16]=e=>l.rule.basedOn.operator=e),options:[">","<",">=","<="],placeholder:"Operator"},null,8,["disabled","modelValue"])]),_:1}),n(p,{name:"basedOn.result",class:"flex items-center"},{error:d(({error:e})=>[s("div",Rl,[e?(a(),o("p",Bl,b(e),1)):y("",!0)])]),default:d(()=>[s("div",zl,[Dl,n(D,{disabled:!l.rule.table,type:"number",min:1,modelValue:l.rule.basedOn.result,"onUpdate:modelValue":t[17]||(t[17]=e=>l.rule.basedOn.result=e)},null,8,["disabled","modelValue"])])]),_:1})]),n(p,{name:"basedOn.groupBy"},{error:d(({error:e})=>[s("div",Ll,[e?(a(),o("p",Ql,b(e),1)):y("",!0)])]),default:d(()=>[l.rule.basedOn.name=="sum"?(a(),o("div",Al,[Ml,s("div",Fl,[N(s("select",{class:"appearance-none relative disabled:cursor-not-allowed disabled:opacity-75 focus:outline-none border-0 inline-flex items-center text-left cursor-default rounded-md text-sm gap-x-1.5 px-2.5 py-1.5 shadow-sm bg-white dark:bg-gray-900 text-gray-900 dark:text-white ring-1 ring-inset ring-gray-300 dark:ring-gray-700 focus:ring-2 focus:ring-primary-500 dark:focus:ring-primary-400 pe-9","onUpdate:modelValue":t[18]||(t[18]=e=>l.rule.basedOn.groupBy=e),name:"",id:""},[s("option",{value:null,selected:!l.rule.basedOn.value,text:"None"},null,8,Pl),(a(!0),o(f,null,g(l.Tables.filter(e=>l.rule.tables.includes(e.name)||e.name==l.rule.table),(e,m)=>(a(),o(f,null,[e.children?(a(),o("optgroup",{key:`${e.name}-optgroup-${m}`,value:e.name,label:e.name},[(a(!0),o(f,null,g(e.children,(i,v)=>(a(),o("option",{key:`${e.name}.${i.name}`,value:"`"+e.name+"`.`"+i.name+"`",selected:i.name===l.rule.basedOn.value,disabled:i.disabled,textContent:b(i.name)},null,8,Il))),128))],8,El)):(a(),o("option",{key:`${e.name}-${m}`,value:e.name,selected:e.name===l.rule.basedOn.value,disabled:e.disabled,textContent:b(e.name)},null,8,Hl))],64))),256))],512),[[S,l.rule.basedOn.groupBy]]),Jl])])):y("",!0)]),_:1})])])]),_:1},8,["schema","state","onSubmit"])])):(a(),o("div",Wl,[n(Z,{count:8})])),n(le,{id:"lll",ui:{width:"w-full sm:max-w-3xl"},modelValue:_.isOpen,"onUpdate:modelValue":t[21]||(t[21]=e=>_.isOpen=e)},{default:d(()=>[n(I,{ui:{ring:"",divide:"divide-y divide-gray-100 dark:divide-gray-800"}},{header:d(()=>[s("div",Kl,[Xl,n(C,{color:"gray",variant:"ghost",icon:"i-heroicons-x-mark-20-solid",class:"-my-1",onClick:t[19]||(t[19]=e=>_.isOpen=!1)})])]),footer:d(()=>[_.resultTest.error?(a(),o("div",Zl,[n($,{icon:"i-heroicons-command-line",color:"red",variant:"subtle",title:"Error: ",description:_.resultTest.error},null,8,["description"])])):(a(),o("div",Gl,[$l,s("div",et,[n(ee,{rows:_.resultTest.rows},null,8,["rows"])])]))]),default:d(()=>[s("div",null,[s("p",Yl,"Query: "+b(_.resultTest.time)+" milliseconds",1),n(G,{value:_.resultTest.query,"onUpdate:value":t[20]||(t[20]=e=>_.resultTest.query=e),tabSize:2,readOnly:!0,options:{mode:"text/x-sql",theme:"dracula",lineWrapping:!0,styleActiveLine:!1}},null,8,["value"])])]),_:1})]),_:1},8,["modelValue"])]),_:1})}const vt=ae(je,[["render",lt]]);export{vt as default};
