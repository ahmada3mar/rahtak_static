import{a as j,_ as q}from"./D_zICvME.js";import{c as f,b as h,w as n,j as g,aN as u,m as N,x as U,o as d,a as t,e as T,d as c,t as S,f as v,u as k,h as $}from"./CSfNu48z.js";import{o as C,p as A,d as _,s as F,l as E,_ as O}from"./NquN9xHw.js";import{_ as R}from"./D1djGihS.js";import{_ as B}from"./qicmLMUY.js";import{_ as D}from"./BSfPtVTN.js";import"./Bz7h1LFa.js";import"./BSWwi08U.js";import"./Bv3t9T-3.js";const w={class:"py-5 px-2"},z={key:0},I=c("h4",{class:"my-5"},"معلومات العميل",-1),M={key:0},G={class:"text-green-500 font-bold"},H={class:"flex mt-5 justify-between"},J=c("h4",{class:"my-5"},"معلومات الدفعة",-1),K={key:2},Q={class:"flex mt-5 justify-between"},W={data(){return{totalTrx:0,isLoading:!1,isUserLoading:!1,input:{},cat:[],billingNo:"",catValue:{name:5},response:null,paid:!1,paymentAmount:0,client:null,user:{name:"",mobile:""},payments:{amount:0,fees:0}}},mounted(){g(`/sadad/get-service-details/${u().params.id}`).then(o=>{var m;this.input=o.input,this.cat=(m=o.cat)==null?void 0:m.filter(p=>p.code)})},methods:{fetchCustomer(o){o.length==10?(this.isUserLoading=!0,g(`/get-customer?search=${o}`).then(m=>{this.user.name=m.name??"",this.totalTrx=m.transactions_count??0,this.isUserLoading=!1})):(this.user.name="",this.totalTrx=0,this.isUserLoading=!1)},saveUser(){this.client={...this.user}},removeUser(){this.client=null},getFees(){return this.payments.amount>=1e3?5:this.payments.amount<=100?.25:(parseInt((this.payments.amount-1)/100)+1)*.5-.25},inq(){var e;this.isLoading=!0;const[o,m]=u().params.service.split("_");let p={paymentType:this.input.paymentType,catValue:this.catValue.nameEn??"",catNo:((e=this.catValue)==null?void 0:e.code)??"",billingNo:this.billingNo,service:o,id:u().params.id,code:m,billingNoRequired:this.input.billingNoRequired,containsPrepaidCats:this.input.containsPrepaidCats,paymentAmount:this.paymentAmount};g("/sadad/inquire",{method:"POST",body:p}).then(a=>{this.response=a,this.payments.amount=parseFloat(a.amount),this.payments.fees=parseFloat(a.fees)}).catch(a=>{N().add({title:a.response._data.message,color:"orange"})}).finally(()=>{this.isLoading=!1})},getAdditionalFees(){let o=parseFloat(this.payments.amount??0)+Number(this.payments.fees??0),m=.25;return o>500&&o<=1e3?m=.5:o>1e3&&(m=1),m},pay(){var e,a,i;this.isLoading=!0;const[o,m]=u().params.service.split("_");let p={paymentType:this.input.paymentType,catValue:this.catValue.nameEn??"",catNo:((e=this.catValue)==null?void 0:e.code)??"",billingNo:this.billingNo,billerName:o,billerCode:m,billerType:u().params.type,totalPayment:parseFloat(Object.values(this.payments).reduce((s,r)=>s+r,this.getAdditionalFees())),dueAmount:this.response.dueAmount,serviceTypeNo:u().params.id,transType:this.response.transType,amount:this.payments.amount,fees:this.payments.fees,rahtak_fees:this.getFees(),validationCode:this.response.validationCode,clientName:((a=this.client)==null?void 0:a.name)??"ahmad",clientMobile:((i=this.client)==null?void 0:i.mobile)??"0799991230",billingNoRequired:this.input.billingNoRequired,containsPrepaidCats:this.input.containsPrepaidCats,additionalAmount:this.getAdditionalFees()??0};g(`/sadad/pay/${u().params.id}`,{method:"POST",body:p}).then(s=>{var r,y;N().add({title:"تم الدفع بنجاح",color:"green"}),this.paid={transaction:s.bankTrxID,created_at:s.sTMTDate,billerName:o,serviceType:((r=U().list.filter(b=>b.id==u().params.id)[0])==null?void 0:r.serviceNameAr)??u().params.type,invoice:this.billingNo,customerName:s.customerName,amount:this.payments.amount,fees:this.payments.fees,addtionalAmount:this.payments.addtionalAmount,rahtakFees:this.getFees(),total:parseFloat(this.getFees()+Object.values(this.payments).reduce((b,V)=>b+V,this.getAdditionalFees())),branch:((y=U().user)==null?void 0:y.branch)??"tabrbor"}}).catch(s=>{N().add({title:s.response._data.message,color:"red"})}).finally(()=>{this.isLoading=!1})}}},ne=Object.assign(W,{__name:"index",setup(o){const m=C({name:A(F(),_("اسم العميل مطلوب")),mobile:A(F(),_("رقم العميل مطلوب"),E(10,"رقم العميل يجب ان يكون 10 ارقام"))}),p=C({billingNo:A(F(),_("الحقل مطلوب"))});return(e,a)=>{const i=j,s=q,r=$,y=O,b=R,V=B,L=D;return d(),f("div",w,[e.paid?(d(),h(L,{key:1,details:e.paid},null,8,["details"])):(d(),h(V,{key:0},{default:n(()=>[e.client?(d(),h(y,{key:1,schema:k(p),state:{billingNo:e.billingNo,paymentAmount:e.paymentAmount},onSubmit:a[10]||(a[10]=l=>e.response?e.pay():e.inq())},{default:n(()=>[J,e.cat.length>0?(d(),h(s,{key:0,class:"my-2",label:"الفئة"},{default:n(()=>[t(b,{modelValue:e.catValue,"onUpdate:modelValue":a[3]||(a[3]=l=>e.catValue=l),options:e.cat,"option-attribute":"nameEn"},null,8,["modelValue","options"])]),_:1})):v("",!0),t(s,{class:"my-2",name:"billingNo",label:e.input.arDesc},{default:n(()=>[t(i,{"onUpdate:modelValue":[a[4]||(a[4]=l=>e.response=null),a[5]||(a[5]=l=>e.billingNo=l)],modelValue:e.billingNo,placeholder:e.input.arDesc},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e.input.billingNoRequired&&!e.input.containsPrepaidCats?(d(),h(s,{key:1,name:"paymentAmount",class:"my-2",label:"القيمة"},{default:n(()=>[t(i,{"onUpdate:modelValue":[a[6]||(a[6]=l=>e.response=null),a[7]||(a[7]=l=>e.paymentAmount=l)],modelValue:e.paymentAmount,placeholder:"ادخل القيمة"},null,8,["modelValue"])]),_:1})):v("",!0),e.response?(d(),f("div",K,[t(s,{class:"my-2",label:"اسم العميل"},{default:n(()=>[t(i,{disabled:!0,value:e.response.customerName},null,8,["value"])]),_:1}),t(s,{class:"my-2",label:"ملاحظات"},{default:n(()=>[t(i,{disabled:!0,value:e.response.freeText},null,8,["value"])]),_:1}),t(s,{class:"my-2",label:"الحد الأعلى"},{default:n(()=>[t(i,{disabled:!0,value:e.response.maxPaymentLimit},null,8,["value"])]),_:1}),t(s,{class:"my-2",label:"الحد الأدنى"},{default:n(()=>[t(i,{disabled:!0,value:e.response.minPaymentLimit},null,8,["value"])]),_:1}),t(s,{class:"my-2",label:"القيمة"},{default:n(()=>[t(i,{type:"number",disabled:!e.response.isAmountEnabled,modelValue:e.payments.amount,"onUpdate:modelValue":a[8]||(a[8]=l=>e.payments.amount=l)},null,8,["disabled","modelValue"])]),_:1}),t(s,{class:"my-2",label:"عمولات"},{default:n(()=>[t(i,{disabled:!0,modelValue:e.payments.fees,"onUpdate:modelValue":a[9]||(a[9]=l=>e.payments.fees=l)},null,8,["modelValue"])]),_:1}),t(s,{class:"my-2",label:"القيمة المضافة"},{default:n(()=>[t(i,{disabled:!0,value:e.getAdditionalFees(e.payments)},null,8,["value"])]),_:1}),t(s,{class:"my-2",label:"عمولة راحتك"},{default:n(()=>[t(i,{disabled:!0,type:"number",value:e.getFees()},null,8,["value"])]),_:1}),t(s,{class:"my-2",label:"القيمة الكلية"},{default:n(()=>[t(i,{disabled:!0,value:parseFloat(Object.values(e.payments).reduce((l,P)=>l+P,e.getAdditionalFees()+e.getFees())).toFixed(3)},null,8,["value"])]),_:1})])):v("",!0),c("div",Q,[t(r,{onClick:e.removeUser,size:"lg",color:"gray",class:"",label:"رجوع"},null,8,["onClick"]),t(r,{loading:e.isLoading,size:"lg",type:"submit",class:"mr-auto",label:e.response?"دفع":"استعلام"},null,8,["loading","label"])])]),_:1},8,["schema","state"])):(d(),f("div",z,[t(y,{onSubmit:e.saveUser,schema:k(m),state:e.user},{default:n(()=>[I,t(s,{class:"my-2",name:"mobile",label:"رقم هاتف العميل"},{default:n(()=>[t(i,{"onUpdate:modelValue":[e.fetchCustomer,a[0]||(a[0]=l=>e.user.mobile=l)],modelValue:e.user.mobile,placeholder:"رقم الهاتف"},null,8,["onUpdate:modelValue","modelValue"])]),_:1}),t(s,{class:"my-2",name:"name",label:"اسم العميل"},{default:n(()=>[t(i,{loading:e.user.mobile!=""&&e.isUserLoading,disabled:e.user.mobile.length<10,"onUpdate:modelValue":[a[1]||(a[1]=l=>e.client=null),a[2]||(a[2]=l=>e.user.name=l)],modelValue:e.user.name,placeholder:"الأسم"},null,8,["loading","disabled","modelValue"])]),_:1}),e.totalTrx?(d(),f("h3",M,[T(" مجموع حركات العميل "),c("span",G,S(e.totalTrx),1),T(" حركة ")])):v("",!0),c("div",H,[t(r,{size:"lg",type:"submit",class:"mr-auto",label:"التالي"})])]),_:1},8,["onSubmit","schema","state"])]))]),_:1}))])}}});export{ne as default};
